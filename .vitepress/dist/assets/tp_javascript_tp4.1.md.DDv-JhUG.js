import{_ as s,c as e,o as i,U as a}from"./chunks/framework.aGaNZw_P.js";const n="/assets/maquette.ChN9CvGk.png",t="/assets/base.BNU3W_71.png",l="/assets/space.BhNona1I.png",p="/assets/random.DQ75rogj.png",r="/assets/bretagne.CSeHAaEa.png",b=JSON.parse('{"title":"La Greta TV 2.0 (Ajax)","description":"Nous avons créé deux cas « de tests », je vous propose de le mettre en place dans un code existant.","frontmatter":{"description":"Nous avons créé deux cas « de tests », je vous propose de le mettre en place dans un code existant."},"headers":[],"relativePath":"tp/javascript/tp4.1.md","filePath":"tp/javascript/tp4.1.md","lastUpdated":1699133994000}'),o={name:"tp/javascript/tp4.1.md"},h=a(`<h1 id="la-greta-tv-2-0-ajax" tabindex="-1">La Greta TV 2.0 (Ajax) <a class="header-anchor" href="#la-greta-tv-2-0-ajax" aria-label="Permalink to &quot;La Greta TV 2.0 (Ajax)&quot;">​</a></h1><p>Nous avons créé deux cas « de tests », je vous propose de le mettre en place dans un code existant. Nous avons réalisé un site la GRETA TV, ce site comportait <strong>« deux pages »</strong> :</p><ul><li>Une page d&#39;accueil <code>home.php</code>, qui affiche la liste des vidéos.</li><li>Une page <code>tv.php</code> ayant pour but l&#39;affichage de la vidéo souhaité.</li></ul><div class="tip custom-block"><p class="custom-block-title">Vous n&#39;avez pas le code source ?</p><p>Celui-ci est <a href="/demo/php/greta-tv/refactor-structure.zip">disponible ici</a>. Il pourra vous servir de base de travail. (c&#39;est une version sans base de données, pour simplifier l&#39;installation locale)</p></div><div class="tip custom-block"><p class="custom-block-title">Vous préférez une approche MVC ?</p><p>La première version du code source fourni est très simple. En tant que développeur, on préfère une approche un peu plus complète que celle-ci. C&#39;est pour ça que je vous propose plutôt d&#39;utiliser la version MVC du projet.</p><p>Celui-ci est <a href="https://github.com/c4software/demo-structure-mvc-video/archive/refs/tags/1.1.zip" target="_blank" rel="noreferrer">disponible ici</a>. La <a href="/tp/php/mvc/tp1.html">documentation est disponible ici</a></p><p><strong>Attention</strong>, la suite du TP repose sur la première version du code source. Les nommages sont différents, mais globalement le fonctionnement reste le même. Si vous voulez jouer, tentez la version MVC.</p></div><p>Comment allons-nous procéder ?</p><ul><li>Dans un premier temps, nous allons regarder le fonctionnement du site actuel.</li><li>Puis, nous allons supprimer les parties PHP « qui affichent les vidéos ». Nous testerons que notre code fonctionne toujours, mais en n’affichant aucune vidéo.</li><li>Nous allons par la suite créer une API. Son but ? Retourner uniquement le contenu (au format JSON bien entendu)</li><li>Puis nous appellerons notre API en Ajax grâce à Fetch depuis notre page.</li></ul><h2 id="la-page-home-php" tabindex="-1">La page <code>home.php</code> <a class="header-anchor" href="#la-page-home-php" aria-label="Permalink to &quot;La page \`home.php\`&quot;">​</a></h2><p>Nous allons rendre dynamique la page d&#39;accueil <code>home.php</code>, dans le sens où :</p><ul><li>Notre serveur va générer une page « Vide » (c&#39;est-à-dire sans la liste de vidéos).</li><li>Notre navigateur va, via un appel Ajax charger la liste des vidéos, et se charger en JavaScript de l&#39;affichage de la liste.</li></ul><p>Avant tout, <strong>pourquoi faire ça ?</strong> L&#39;avantage de découper le traitement comme ça. C&#39;est que nous pourrions très simplement créer un client « Mobile », et ça sans toucher au code de notre serveur. Pleins d&#39;avantages :</p><ul><li>Code unique pour le Web et les autres plateformes</li><li>Centralisation de la logique dans un code dédié à la récupération « du contenu » (les vidéos en l&#39;occurrence).</li><li>Approche microservices, nous pouvons donc héberger notre site Internet sur une autre plateforme que l&#39;API.</li></ul><div class="danger custom-block"><p class="custom-block-title">Un INSTANT !</p><p>Une API ? What ? Alors, une API dans le fond c&#39;est « comme un site web ». Mais, cette page web ne produit pas du HTML et n&#39;a pas pour vocation d&#39;être lue par un humain.</p><p>C&#39;est donc du code (PHP ou autre) qui va permettre de faire parler deux ordinateurs (le client et le serveur) dans un langage spécifique (XML, JSON …)</p></div><h3 id="etape-1-analyse-du-code" tabindex="-1">Étape 1 : Analyse du code <a class="header-anchor" href="#etape-1-analyse-du-code" aria-label="Permalink to &quot;Étape 1 : Analyse du code&quot;">​</a></h3><p>La première étape va être de créer l&#39;API, nous allons donc regarder comment fonctionne le code que vous avez téléchargé. Je vous laisse regarder, une fois analysé, nous allons en parler ensemble.</p><details class="details custom-block"><summary>Analyse du code</summary><p>Le code qui nous intéresse est présent dans le fichier <code>home.php</code> ; celui-ci contient quelques lignes de code, mais si nous y regardons de plus près seules quelques lignes sont intéressantes :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BcgsOgjHgWA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lcOxhH8N3Bo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jTuBnZrLbq0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;M2VtfZDOcHQ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;i1iIaSbK9bg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MTaHw-S6IDo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;KfMCApWc5xE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;igtN49I1CtM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $id) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;col-sm-12 col-md-3 p-3&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;card&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;card-body text-center&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> href</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;index.php?page=tv&amp;id=&lt;?=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;btn btn-outline-primary&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Video</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;?=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;&lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Nous pouvons y voir un exemple de code PHP très simple à savoir :</p><ul><li>Une variable <code>$videos</code>, celle-ci contient la liste des vidéos à afficher. <em>C&#39;est notre source de données</em>.</li><li><code>$i</code> est une variable qui permettra d&#39;afficher <code>Video X</code> (1… X). <em>Note, cette variable peut-être remplacée par une boucle foreach différente <code>foreach $videos as $i =&gt; $id</code></em></li><li>Du code HTML, celui-ci permet d&#39;afficher une liste de Card à la suite avec dedans un bouton permettant d&#39;accéder à la page <code>tv.php</code>.</li></ul></details><hr><p>Une autre partie du code est intéressante, le fichier <code>index.php</code> ; ce fichier est un entrypoint, c&#39;est une bonne pratique que je vous encourage vraiment à pratiquer. Regardons le fichier ensemble ! Et plus particulièrement la variable, <code>$whitelist</code> celle-ci contient la liste des pages <strong>autorisées</strong>.</p><div class="tip custom-block"><p class="custom-block-title">Whitelist ?</p><p>La sécurité, vous connaissez ? J&#39;espère, quand vous développez un site Internet, vous êtes par définition « en short » sur la toile. Votre site peut-être et sera certainement (je vous le garantis pour l&#39;avoir vécue) piraté par une personne malveillante. Comment s&#39;en prémunir alors ? Tout simplement empêchant au maximum l&#39;exploitation de problème connut.</p><p>Créer une <code>whitelist</code> va nous permettre de dormir paisiblement, nous allons contrôler finement ce que l&#39;utilisateur va pouvoir inclure. Vous retrouverez cette pratique dans différents langages sous différent nom (Un <code>router</code> peut-être assimilé à ce genre de pratique).</p></div><hr><p>Le précédent développeur a visiblement travaillé pour vous… 😉 😉. Vous trouverez également dans le projet un fichier <code>api.php</code> ainsi qu&#39;un dossier <code>api</code> celui-ci contient le code permettant de :</p><ul><li>Déclarer des API. (dossier <code>api/</code>)</li><li>Sécuriser les API.</li><li>Centraliser la gestion de celle-ci. (<code>api.php</code>)</li></ul><div class="tip custom-block"><p class="custom-block-title">👀 Vous pouvez tester dès maintenant 👀</p><p>Vous avez une API de disponible dans le projet. Celle-ci contient du contenu fictif, vous pouvez l&#39;appeler avec le lien :</p><ul><li><a href="http://localhost/leDossierDeVotreProjet/api.php?page=sample" target="_blank" rel="noreferrer">http://localhost/leDossierDeVotreProjet/api.php?page=sample</a></li></ul><p>🤓 Je vous laisse tester.</p></div><h3 id="etape-2-creer-l-api" tabindex="-1">Étape 2 : Créer l&#39;API <a class="header-anchor" href="#etape-2-creer-l-api" aria-label="Permalink to &quot;Étape 2 : Créer l&#39;API&quot;">​</a></h3><p>Nous avons maintenant analysé le code actuellement fonctionnel. Nous allons donc créer une API qui devra retourner « seulement la liste des vidéos ». Nous allons utiliser la fonction <code>json_encode</code> fournie <strong>de base</strong> en PHP.</p><p>Cette fonction permet :</p><blockquote><p>Retourne une chaine de caractères contenant la représentation JSON de la valeur value.</p><p>L&#39;encodage est affecté par les flags fournis. De plus, l&#39;encodage des valeurs flottantes dépend de la valeur de serialize_precision.</p></blockquote><p><em>Source:</em> <a href="https://www.php.net/manual/fr/function.json-encode.php" target="_blank" rel="noreferrer">https://www.php.net/manual/fr/function.json-encode.php</a></p><p>Cette fonction nous permet donc de transformer une <code>variable</code> en quelque chose de transférable simplement vers un autre système. Ce quelque chose est du JSON :</p><blockquote><p>JSON est un format de données textuelles dérivé de la notation des objets du langage JavaScript. Il permet de représenter de l’information structurée comme le permet XML par exemple.</p></blockquote><p><em>Source:</em> Wikipédia</p><h4 id="place-au-code" tabindex="-1">Place au code <a class="header-anchor" href="#place-au-code" aria-label="Permalink to &quot;Place au code&quot;">​</a></h4><p>Nous devons donc écrire une API… Une API c&#39;est <strong>juste un fichier PHP</strong> comme un autre ; à la seule différence que celui-ci ne retourne pas du HTML, mais du JSON. Vous avez un exemple d&#39;API dans le projet avec le fichier <code>sample.php</code>, je vous laisse le regarder…</p><p>Une fois celui-ci analysé, je vous laisse créer votre fichier, par exemple <code>videos.php</code> <strong>dans le dossier <code>api/</code></strong> ça sera notre futur API ! Nous avons maintenant une API <strong>vide</strong> ! Mais que mettre dedans ?</p><ul><li>À votre avis ?</li><li>Du code PHP 😮</li><li>La réponse D ?</li></ul><p>Je vous aide! Nous allons y mettre du code PHP… Et plus particulièrement le contenu de <strong>notre source de données</strong> ! Mais quel code à votre avis ?</p><ul><li>Vous allez devoir créer la variable <code>$videos</code> (comme sur la home).</li><li>Utiliser la fonction <code>json_encode</code> et <code>echo</code> pour envoyer le contenu de la variable au client au format JSON.</li></ul><details class="details custom-block"><summary>En panne d&#39;inspiration ?</summary><p>Je vous aide :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BcgsOgjHgWA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lcOxhH8N3Bo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jTuBnZrLbq0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;M2VtfZDOcHQ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;i1iIaSbK9bg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MTaHw-S6IDo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;KfMCApWc5xE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;igtN49I1CtM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($videos);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ?&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>Je vous laisse mettre en place l&#39;API dans votre code. <strong>N&#39;oubliez pas de la tester !</strong></p><div class="tip custom-block"><p class="custom-block-title">L&#39;astuce du chef</p><p>Pour tester votre API, vous avez la possibilité d’utiliser le logiciel PostMan. PostMan va vous permettre de tester vos API simplement avec une interface graphique.</p><p>Téléchargez-le <a href="https://www.getpostman.com/" target="_blank" rel="noreferrer">ici</a></p></div><h3 id="etape-2-modifier-le-code-existant" tabindex="-1">Étape 2 : Modifier le code existant <a class="header-anchor" href="#etape-2-modifier-le-code-existant" aria-label="Permalink to &quot;Étape 2 : Modifier le code existant&quot;">​</a></h3><p>Je vous laisse modifier le code PHP de la page <code>home.php</code> pour le vider de tout <code>PHP</code> celui-ci doit-être vide ! Il ne va contenir que le minimum à savoir la structure interne de la page :</p><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;container&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;container&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;row pt-5&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      &lt;!-- Nous allons insérer ICI le contenu grace à l&#39;AJAX --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Vous ajouterez ici prochainement le code JavaScript permettant de faire l&#39;appel Ajax (avec fetch)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="etape-3-appeler-l-api-en-ajax" tabindex="-1">Étape 3 : Appeler l&#39;API en Ajax <a class="header-anchor" href="#etape-3-appeler-l-api-en-ajax" aria-label="Permalink to &quot;Étape 3 : Appeler l&#39;API en Ajax&quot;">​</a></h3><p>Comme nous l&#39;avons fait précédemment, je vous laisse reprendre le code. Mais le code va ressembler à :</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./api.php?page=videos&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">datas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Votre code ICI, vous devez parcourir les vidéos (comme dans l&#39;exemple précédent) pour les ajouter dans le #content (comme dans l&#39;exemple précédent)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><details class="details custom-block"><summary>à court d&#39;idées sur le code à écrire ?</summary><p>NON ? Vous n&#39;allez pas tricher comme ça… Non pas vous ?</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// À mettre dans le then</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">datas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">el</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertAdjacentHTML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;beforeend&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;div class=&quot;col-sm-12 col-md-3 p-3&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &lt;div class=&quot;card&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &lt;div class=&quot;card-body text-center&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &lt;a href=&quot;index.php?page=tv&amp;id=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">el</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot; class=&quot;btn btn-outline-primary&quot;&gt;Video \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&lt;/a&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &lt;/div&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &lt;/div&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;/div&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>⚠️ Non… Ce n&#39;est pas la seule façon de faire. Maintenant que vous avez vu MA solution. Je vous laisse écrire la vôtre.</p></details><p>🤓 Je vous laisse travailler à la mise en place du code en question. Tester ensuite que la page s&#39;affiche comme précédemment.</p><h3 id="etape-4-evolution-de-la-page" tabindex="-1">Étape 4 : Évolution de la page <a class="header-anchor" href="#etape-4-evolution-de-la-page" aria-label="Permalink to &quot;Étape 4 : Évolution de la page&quot;">​</a></h3><p>Ajouter un bouton rafraîchir dans la page. Le bouton rafraîchir doit permettre de récupérer à nouveau la liste des vidéos pour les mettre à jour dans la page.</p><ul><li>Ajouter une icône à droite dans l&#39;interface.</li><li>Utiliser les icônes fournies par bootstrap.</li><li>Ajouter une action <code>onClick</code> permettant de déclencher l&#39;action (<code>function</code>) permettant d&#39;obtenir les vidéos en Ajax (c&#39;est le code que vous avez déjà écrit)</li></ul><p>Voilà la maquette :</p><p><img src="`+n+`" alt="Maquette rendue" loading="lazy"></p><h2 id="allons-plus-loin" tabindex="-1">Allons plus loin <a class="header-anchor" href="#allons-plus-loin" aria-label="Permalink to &quot;Allons plus loin&quot;">​</a></h2><p>Nous avons fait la page <code>home.php</code> ensemble. Actuellement, nous avons un fond « brick » sur la page TV (<code>tv.php</code>) ; je vous propose de changer cette page ! Pour ça vous allez devoir procéder à différents ajustements :</p><ul><li>Ajouter dans la structure de données la notion de thème. (un thème différent par vidéo)</li><li>Retourner dans <strong>une nouvelle</strong> API (<code>getVideoDetails</code>), les informations nécessaires au bon affichage du thème.</li><li>Utiliser le retour dans votre page.</li></ul><details class="details custom-block"><summary>Quelques éléments en plus pour vous aider</summary><ul><li>Vous allez avoir besoin évidemment de <code>fetch</code> (ou de jQuery) afin de faire l&#39;appel Ajax.</li><li>Votre API doit retourner la class CSS à appliquer au <code>body</code>.</li><li>Vous pouvez appliquer la class CSS via : <code>document.body.classList.add(&quot;votreClass&quot;)</code>.</li></ul><p>Comme dans le premier exemple, vous devez utiliser le résultat de votre API, cette fois-ci le JSON n&#39;est pas obligatoire, voilà une piste de réponse :</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lurldevotreapi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resultat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.body.classList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resultat));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><p>Voilà quelques exemples du résultat :</p><p><img src="`+t+'" alt="Base" loading="lazy"><img src="'+l+'" alt="Space" loading="lazy"><img src="'+p+'" alt="Random" loading="lazy"><img src="'+r+'" alt="Bretagne" loading="lazy"></p><h2 id="l-etape-bonus" tabindex="-1">L&#39;étape bonus <a class="header-anchor" href="#l-etape-bonus" aria-label="Permalink to &quot;L&#39;étape bonus&quot;">​</a></h2><p>Je vous ai indiqué en introduction que le but de créer des API était de permettre de créer simplement plusieurs clients avec comme source de données la même information. Je vous propose donc de mettre ça en pratique ! Nous allons donc créer un autre client web qui consommera nos données. Voilà les éléments que vous devrez réaliser :</p><ul><li>Le client Web devra être hébergé sur <a href="https://www.netlify.com" target="_blank" rel="noreferrer">Netlify</a>.</li><li>Avoir un visuel différent de votre page (home.php) actuelle. (Vous pouvez vous inspirer de YouTube par exemple ou Twitch).</li><li>Avoir une information indiquant chargement pendant la récupération de la liste des vidéos.</li></ul><div class="warning custom-block"><p class="custom-block-title">Un instant !</p><p>Lors de votre développement, vous allez rencontrer un problème de Cross Origin. Le Cross Origin Resource Sharing (CORS) est une protection intégrée dans votre navigateur qui vous empêche depuis le domaine A d&#39;appeler une ressource sur le domaine B. La raison ? Elle est simple empêcher le partage non désiré d&#39;information entre deux sites.</p><p>En tant que développeur (si si), vous pouvez contrôler comment fonctionne cette protection. Vous pouvez dans vos API décider qui vous appellera (quel domaine), de manière fine ou de manière complètement ouverte (<code>*</code>). Pour rendre votre code le plus permissif possible vous pouvez ajouter dans votre API PHP le code suivant (tout en haut) :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Origin: *&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Vous pouvez évidemment être plus précis, en indiquant un domaine spécifique :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Origin: https://www.example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div>',63),d=[h];function u(c,k,g,E,m,v){return i(),e("div",null,d)}const F=s(o,[["render",u]]);export{b as __pageData,F as default};
