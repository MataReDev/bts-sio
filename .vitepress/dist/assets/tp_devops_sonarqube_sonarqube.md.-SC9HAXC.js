import{_ as s,c as a,o as e,U as i}from"./chunks/framework.aGaNZw_P.js";const n="/assets/sonar_analyse.Ca8t-fQs.png",t="/assets/token_generation.CTmJ3YHP.png",l="/assets/sonar_result.o2v3PZao.png",F=JSON.parse('{"title":"SonarQube","description":"","frontmatter":{},"headers":[],"relativePath":"tp/devops/sonarqube/sonarqube.md","filePath":"tp/devops/sonarqube/sonarqube.md","lastUpdated":1621884336000}'),r={name:"tp/devops/sonarqube/sonarqube.md"},o=i('<h1 id="sonarqube" tabindex="-1">SonarQube <a class="header-anchor" href="#sonarqube" aria-label="Permalink to &quot;SonarQube&quot;">​</a></h1><p>Dans ce TP nous allons voir comment utiliser SonarQube avec Gitlab-CI.</p><details class="details custom-block"><summary>Sommaire</summary><nav class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#installation">Installation</a><ul><li><a href="#installation-via-docker">Installation via Docker</a></li><li><a href="#premier-lancement">Premier lancement</a></li></ul></li><li><a href="#utilisation">Utilisation</a><ul><li><a href="#creation-du-token">Création du Token</a></li><li><a href="#gitlab-ci">Gitlab-CI</a></li></ul></li><li><a href="#analyse-des-resultats">Analyse des résultats</a></li></ul></nav></details><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>Nous l&#39;avons vu en cours, SonarQube est un outil très puissant il va vous permettre d&#39;analyser votre code de manière statique. C&#39;est-à-dire via une analyse à base d&#39;expression régulière.</p><p>L&#39;objectif de Sonar est de vous donner des indicateurs « simplifié » pour comprendre comment « va votre projet » / afin d&#39;en mesurer ça santé. Cette santé est exprimée sous la forme de 4 grandes notes :</p><ul><li>Le nombre de « bugs ».</li><li>Le nombre de vulnérabilités.</li><li>Le nombre de points chauds / sensibles à vérifier.</li><li>La dette technique</li></ul><p><img src="'+n+'" alt="Analyse" loading="lazy"></p><p>Nous analyserons ensemble les indicateurs. Cette note ne doit pas être prise comme une finalité <strong>c&#39;est très important</strong>, elle doit être prise comme un indicateur permettant de vous améliorer au fur et à mesure (à chaque évolution idéalement).</p><p><strong>L&#39;objectif étant de ne pas faire baisser la note.</strong></p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><p>En fonction du langage SonarQube peut-être gourmand (très gourmand même). Pour tester, je vous propose de monter un SonarQube dans un cluster Kubernetes (car pourquoi pas ?).</p><p><a href="https://github.com/c4software/kubernetes-sonarqube" target="_blank" rel="noreferrer">Vous pouvez suivre l&#39;installation ici</a></p><h3 id="installation-via-docker" tabindex="-1">Installation via Docker <a class="header-anchor" href="#installation-via-docker" aria-label="Permalink to &quot;Installation via Docker&quot;">​</a></h3><p>Vous pouvez également lancer simplement SonarQube avec Docker :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sonarqube</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:9000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sonarqube:latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="danger custom-block"><p class="custom-block-title">Quelques soit la solution</p><p>Nous parlons ici de <strong>tester</strong> sonarqube, il est évident que si nous devions l&#39;installer « en prod » / « pour de vrai » il faudrait :</p><ul><li>Dédier un serveur.</li><li>Configurer une base de données externe autre que <code>H2</code>.</li></ul></div><h3 id="premier-lancement" tabindex="-1">Premier lancement <a class="header-anchor" href="#premier-lancement" aria-label="Permalink to &quot;Premier lancement&quot;">​</a></h3><p><strong>Attention</strong>, le premier lancement de SonarQube est relativement long.</p><h2 id="utilisation" tabindex="-1">Utilisation <a class="header-anchor" href="#utilisation" aria-label="Permalink to &quot;Utilisation&quot;">​</a></h2><p>L&#39;utilisation du SonarQube est relativement simple, elle se découpe en deux étapes :</p><ul><li>Création d&#39;un token pour autoriser l&#39;échange entre votre Gitlab et votre SonarQube.</li><li>Ajouter la configuration dans votre CI pour permettre l&#39;envoi des informations.</li></ul><h3 id="creation-du-token" tabindex="-1">Création du Token <a class="header-anchor" href="#creation-du-token" aria-label="Permalink to &quot;Création du Token&quot;">​</a></h3><p>Le token est une sorte « d&#39;alias » permettant d&#39;autoriser l&#39;accès à votre compte sans fournir le login et le mot de passe. Vous pouvez le créer dans votre compte utilisateur :</p><p><img src="'+t+`" alt="Génération du Token" loading="lazy"></p><div class="danger custom-block"><p class="custom-block-title">C&#39;est secret !</p><p>Votre token est personnel, vous devez le garder <strong>secret</strong> sous peine d&#39;introduire une faille de sécurité.</p></div><h3 id="gitlab-ci" tabindex="-1">Gitlab-CI <a class="header-anchor" href="#gitlab-ci" aria-label="Permalink to &quot;Gitlab-CI&quot;">​</a></h3><p>Cette partie est issue de la documentation de SonarQube, je vous laisse le mettre dans votre projet. Ici pas d&#39;aide vous l&#39;avez déjà fait plusieurs fois.</p><p>N&#39;oubliez pas de :</p><ul><li>Changer la projectKey par une valeur pour vous.</li><li><code>http(s)://ip.ou.domaine.vers.votre.sonar</code> par le lien vers votre SonarQube.</li><li><code>VOTRE-TOKEN</code> par le token obtenu à l&#39;étape précédente</li></ul><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sonarqube-check:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  stage:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  image:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sonarsource/sonar-scanner-cli:latest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    entrypoint:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  variables:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    SONAR_USER_HOME:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CI_PROJECT_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/.sonar&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Defines the location of the analysis task cache</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    GIT_DEPTH:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Tells git to fetch all the branches of the project, required by the analysis task</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cache:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    key:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CI_JOB_NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    paths:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .sonar/cache</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  script:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sonar-scanner</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dsonar.qualitygate.wait=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dsonar.projectKey=vitejs-sample</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dsonar.sources=.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dsonar.host.url=http(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">)://ip.ou.domaine.vers.votre.sonar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dsonar.login=VOTRE-TOKEN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  allow_failure:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  only:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Je pense que l&#39;on devrait en parler non ? Pendant que ça analyse, prenons quelques minutes pour comprendre les spécificités de cette configuration.</p><h2 id="analyse-des-resultats" tabindex="-1">Analyse des résultats <a class="header-anchor" href="#analyse-des-resultats" aria-label="Permalink to &quot;Analyse des résultats&quot;">​</a></h2><p>Le plus important dans l&#39;utilisation de SonarQube ce n&#39;est pas les indicateurs en eux-mêmes (quoique) mais plutôt la tendance de votre projet. En effet l&#39;idée derrière des outils tels que SonarQube c&#39;est d&#39;analyser de manière continue afin d&#39;améliorer de manière continue votre application.</p><p><img src="`+l+'" alt="Résultats Sonar" loading="lazy"></p><p>Je vous laisse analyser un projet « plus conséquent » afin que nous puissions discuter d&#39;un code avec de vrais problèmes 😉.</p>',36),p=[o];function u(h,d,c,k,m,b){return e(),a("div",null,p)}const C=s(r,[["render",u]]);export{F as __pageData,C as default};
