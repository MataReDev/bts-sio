import{_ as a}from"./chunks/namespace_resolver.-7TJPEmA.js";import{_ as n,c as l,k as s,I as t,w as r,U as e,D as p,o as h}from"./chunks/framework.aGaNZw_P.js";const d="/assets/api_project_modele.BMLCbuJO.jpg",o="/assets/api_project_modele_jointure.DU-wASBs.jpg",_=JSON.parse('{"title":"Des API avec Laravel","description":"Nous avons vu la puissance de Laravel dans les précédents TP. Nous allons voir que nous pouvons également créer des API avec Laravel.","frontmatter":{"description":"Nous avons vu la puissance de Laravel dans les précédents TP. Nous allons voir que nous pouvons également créer des API avec Laravel."},"headers":[],"relativePath":"tp/laravel/api_produit.md","filePath":"tp/laravel/api_produit.md","lastUpdated":1701975940000}'),u={name:"tp/laravel/api_produit.md"},k=e(`<h1 id="des-api-avec-laravel" tabindex="-1">Des API avec Laravel <a class="header-anchor" href="#des-api-avec-laravel" aria-label="Permalink to &quot;Des API avec Laravel&quot;">​</a></h1><p>Dans ce TP nous allons voir comment il est possible de créer des API avec Laravel. En reprenant les bases vues dans les TP précédents, nous allons voir comment il est possible de créer une API permettant de gérer des données.</p><details class="details custom-block"><summary>Sommaire</summary><nav class="table-of-contents"><ul><li><a href="#description-du-projet">Description du projet</a></li><li><a href="#prerequis">Prérequis</a></li><li><a href="#la-base-de-donnees">La base de données</a></li><li><a href="#creation-d-un-projet">Création d&#39;un projet</a></li><li><a href="#initialisation">Initialisation</a></li><li><a href="#tester-le-projet">Tester le projet</a></li><li><a href="#importer-la-base-de-donnees">Importer la base de données</a><ul><li><a href="#installer-le-generateur-de-modele">Installer le générateur de modèle</a></li><li><a href="#generer-les-modeles">Générer les modèles</a></li><li><a href="#les-modeles-generes">Les modèles générés</a></li></ul></li><li><a href="#creer-un-jeu-de-donnees-de-test">Créer un jeu de données de test</a><ul><li><a href="#autoriser-les-factories">Autoriser les factories</a></li><li><a href="#creer-une-factory">Créer une factory</a></li><li><a href="#definir-votre-seeder">Définir votre Seeder</a></li><li><a href="#et-les-produits">Et les Produits ?</a></li></ul></li><li><a href="#creation-de-l-api">Création de l&#39;API</a></li><li><a href="#testons-les-modeles">Testons les modèles</a><ul><li><a href="#_1-creation-du-controleur">1. Création du contrôleur</a></li><li><a href="#_2-declarer-les-routes">2. Déclarer les routes</a></li><li><a href="#_3-declarer-la-methode">3. Déclarer la méthode</a></li><li><a href="#_4-testons">4. Testons</a></li></ul></li><li><a href="#point-etape-git">Point étape : GIT</a></li><li><a href="#la-route-permettant-de-recuperer-un-produit-en-particulier">La route permettant de récupérer un produit en particulier</a></li><li><a href="#creer-un-nouveau-produit">Créer un nouveau produit</a><ul><li><a href="#_1-creer-la-route">1. Créer la route</a></li><li><a href="#_2-creer-la-methode">2. Créer la méthode</a></li><li><a href="#_3-tester">3. Tester</a></li></ul></li><li><a href="#point-etape-git-1">Point étape : GIT</a></li><li><a href="#creer-une-nouvelle-commande">Créer une nouvelle commande</a></li><li><a href="#lister-toutes-les-commandes-d-un-client">Lister toutes les commandes d&#39;un client</a><ul><li><a href="#obtenir-les-commandes-d-un-client">Obtenir les commandes d&#39;un client</a></li><li><a href="#obtenir-les-produits-commandes-par-un-client-solution-alternative">Obtenir les produits commandés par un client solution alternative</a></li></ul></li><li><a href="#supprimer-une-commande">Supprimer une commande</a></li><li><a href="#creer-un-client">Créer un client</a></li><li><a href="#authentification-d-un-client">Authentification d&#39;un client</a></li><li><a href="#aller-plus-loin">Aller plus loin</a></li><li><a href="#conclusion">Conclusion</a></li></ul></nav></details><div class="tip custom-block"><p class="custom-block-title">Un instant</p><p>Avant de continuer, dans ce TP, nous allons réaliser des API. Les API en elles-mêmes ne servent pas directement. Elles seront utilisées par des applications mobiles ou des sites web.</p><p>Nous allons donc voir comment créer des API et comment les utiliser.</p><p>Vous utiliserez les outils que vous souhaitez pour tester les API. Je vous conseille d&#39;utiliser <a href="https://www.postman.com/" target="_blank" rel="noreferrer">Postman</a> qui est un outil très pratique pour tester les API.</p><p>Plus tard, dans le cours de développement Flutter vous utiliserez ces API pour générer une application dynamique.</p></div><h2 id="description-du-projet" tabindex="-1">Description du projet <a class="header-anchor" href="#description-du-projet" aria-label="Permalink to &quot;Description du projet&quot;">​</a></h2><p>Ici nous n&#39;allons pas utiliser de HTML, CSS ou autres. Nous allons uniquement manipuler de la donnée et les renvoyer au format JSON. Notre projet va permettre :</p><ul><li>Lister les produits présents en base de données.</li><li>Commander un ou plusieurs produits.</li><li>Se connecter avec un compte client.</li></ul><div class="tip custom-block"><p class="custom-block-title">API, JSON ?</p><p>Une API est le cœur de beaucoup de systèmes moderne. Il est important de comprendre ce concept dès à présent. Pourquoi faire une API ?</p><p>Une API va nous permettre de séparer la logique entre client et serveur afin de réaliser si vous le souhaitez différent client pour la même donnée (exemple Twitter avec des clients multiplates-formes).</p><p>Pourquoi préférer une API « JSON / XML » à un retour HTML basic ? Tout simplement, car l&#39;API va être universelle; nous pourrons donc l&#39;utiliser dans un site Internet, mais également dans une application ou n&#39;importe quel client applicatif (web, Android, iOs, une voiture, une TV…).</p></div><h2 id="prerequis" tabindex="-1">Prérequis <a class="header-anchor" href="#prerequis" aria-label="Permalink to &quot;Prérequis&quot;">​</a></h2><p>Pour pouvoir réaliser ce TP, vous devez avoir installé Composer sur votre machine. Je vous invite à suivre la documentation officielle : <a href="https://getcomposer.org/download/" target="_blank" rel="noreferrer">https://getcomposer.org/download/</a> si ce n&#39;est pas déjà fait.</p><h2 id="la-base-de-donnees" tabindex="-1">La base de données <a class="header-anchor" href="#la-base-de-donnees" aria-label="Permalink to &quot;La base de données&quot;">​</a></h2><p>Dans ce TP, nous allons inverser la manière dont nous utilisons laravel. Habituellement, nous créons une base de données et nous créons ensuite les migrations. Ici je vais vous fournir un script SQL qui va créer la base de données et les tables.</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clients</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  nom </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  prenom </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">InnoDB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHARSET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8_bin;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> commandes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id_client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id_produit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  quantite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">InnoDB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHARSET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8_bin;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> produits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  nom </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lien_image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  prix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">decimal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tva </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">decimal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">InnoDB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHARSET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8_bin;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> commandes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fk_idClient (id_client),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fk_idProduit (id_produit),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CONSTRAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fk_idClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FOREIGN KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id_client) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REFERENCES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`clients\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON DELETE CASCADE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CASCADE,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CONSTRAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fk_idProduit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FOREIGN KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id_produit) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REFERENCES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> produits (id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON DELETE CASCADE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CASCADE;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">C&#39;est à vous</p><p>Je vous laisse créer la base de données en utilisant le script SQL ci-dessus. Vous pouvez utiliser le logiciel de votre choix pour créer la base de données.</p></div><h2 id="creation-d-un-projet" tabindex="-1">Création d&#39;un projet <a class="header-anchor" href="#creation-d-un-projet" aria-label="Permalink to &quot;Création d&#39;un projet&quot;">​</a></h2><p>Maintenant que nous avons notre base de données, nous allons créer notre projet. Pour cela, nous allons utiliser la commande <code>create-project</code> de Composer.</p><p>✋ Attention, le projet sera créé dans le dossier courant.</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">composer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create-project</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --prefer-dist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> laravel/laravel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mon-premier-projet</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>La commande va télécharger l&#39;ensemble des dépendances nécessaire et va créer un dossier <code>mon-premier-projet</code> avec les sources.</p><details class="details custom-block"><summary>vous avez récupéré le projet via GIT ?</summary><p>Si vous avez récupéré le projet depuis GIT vous n&#39;allez bien évidemment pas utiliser la commande <code>create-project</code>… Par contre vous allez devoir réinstaller les dépendances (<code>vendor</code>) de votre projet. C&#39;est très simple :</p><p>Dans le dossier de votre projet, lancer la commande :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">composer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></details><h2 id="initialisation" tabindex="-1">Initialisation <a class="header-anchor" href="#initialisation" aria-label="Permalink to &quot;Initialisation&quot;">​</a></h2><p>Votre nouveau projet contient un fichier <code>.env</code> ouvrez-le, et indiquer à Laravel la base de données à utiliser.</p><h2 id="tester-le-projet" tabindex="-1">Tester le projet <a class="header-anchor" href="#tester-le-projet" aria-label="Permalink to &quot;Tester le projet&quot;">​</a></h2><p>Avant de commencer à coder, nous allons tester que notre projet fonctionne correctement. Pour cela, nous allons utiliser la commande <code>serve</code> de Laravel.</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="importer-la-base-de-donnees" tabindex="-1">Importer la base de données <a class="header-anchor" href="#importer-la-base-de-donnees" aria-label="Permalink to &quot;Importer la base de données&quot;">​</a></h2><p>L&#39;idée de ce TP est de générer automatiquement les modèles à partir de la structure de votre base de données.</p><p>Pourquoi générer nos modèles ? L&#39;avantage de générer nos modèles c&#39;est qu&#39;ils vont vraiment être complets.</p><p>Ils contiendront évidemment les, <code>$fillable</code> mais également les jointures entre les tables !</p><h3 id="installer-le-generateur-de-modele" tabindex="-1">Installer le générateur de modèle <a class="header-anchor" href="#installer-le-generateur-de-modele" aria-label="Permalink to &quot;Installer le générateur de modèle&quot;">​</a></h3><p>Pour générer les modèles, nous allons utiliser un plugin que nous allons ajouter avec Composer.</p><p>Le plugin en question <a href="https://github.com/reliese/laravel" target="_blank" rel="noreferrer">Reliese Laravel Model Generator</a></p><p>Pour l&#39;installer, la procédure est simple :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">composer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> require</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reliese/laravel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor:publish</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tag=reliese-models</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config:clear</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Un instant !</p><p>Qu&#39;avez-vous installé ? Quels fichiers ont été modifiés ? Je vous laisse regarder, nous allons en parler !</p></div><h3 id="generer-les-modeles" tabindex="-1">Générer les modèles <a class="header-anchor" href="#generer-les-modeles" aria-label="Permalink to &quot;Générer les modèles&quot;">​</a></h3><div class="danger custom-block"><p class="custom-block-title">Attention</p><p>Avant de générer les modèles, je vous laisse vérifier la configuration de votre, <code>.env</code> notamment au niveau de la base de données.</p></div><p>Maintenant que votre base de données est configurée et prête à être utilisée depuis Laravel, nous allons pouvoir générer l&#39;ensemble des modèles de notre application.</p><p>Pour générer <strong>l&#39;ensemble des modèles,</strong> nous allons saisir une nouvelle commande (celle-ci a été ajoutée par le plugin que vous venez d&#39;ajouter) :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> code:models</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">C&#39;est rapide et ça fonctionne !</p><p>En quelques secondes le plugin a créé l&#39;ensemble des modèles de votre projet. Je vous laisse regarder les modifications dans votre projet, et surtout le dossier <code>models</code></p></div><h3 id="les-modeles-generes" tabindex="-1">Les modèles générés <a class="header-anchor" href="#les-modeles-generes" aria-label="Permalink to &quot;Les modèles générés&quot;">​</a></h3><p>Avant d&#39;aller plus loin, regardons ensemble un peu les modèles :</p><p><img src="`+d+'" alt="Les modèles" loading="lazy"></p><p>Vous vous souvenez des jointures ? Je vous avais expliqué qu&#39;il était possible de les définir dans Laravel pour requêter simplement votre base de données. Dans le code généré par le plugin, nous avons évidemment celle-ci, voilà un exemple :</p><p><img src="'+o+`" alt="Les modèles" loading="lazy"></p><div class="danger custom-block"><p class="custom-block-title">STOP</p><p>Ici, pas de magie ! Le plugin ne fait qu&#39;écrire du code à votre place. Le code vous ne pouvez <strong>évidemment pas l&#39;inventer,</strong> il est dans la documentation officielle de Laravel.</p><p>Vous l&#39;avez oublié ? Pas de problème :</p><p><a href="/cheatsheets/laravel/quick.html">Aide mémoire Laravel</a><a href="https://laravel.com/docs/8.x/eloquent" target="_blank" rel="noreferrer">La documentation de base</a><a href="https://laravel.com/docs/8.x/eloquent-relationships" target="_blank" rel="noreferrer">Les jointures et Eloquent</a></p></div><h2 id="creer-un-jeu-de-donnees-de-test" tabindex="-1">Créer un jeu de données de test <a class="header-anchor" href="#creer-un-jeu-de-donnees-de-test" aria-label="Permalink to &quot;Créer un jeu de données de test&quot;">​</a></h2><p>Nous avons donc maintenant une base de données de test. Avant d&#39;aller plus loin… Je vous laisse insérer des données fictives pour que nous ayons un peu de contenu.</p><p>Vous avez deux façons de faire ça :</p><ul><li>Directement en base « manuellement ».</li><li><a href="https://laravel.com/docs/8.x/seeding" target="_blank" rel="noreferrer">Via Une Factories + Un Seeder de Laravel</a></li></ul><p>L&#39;avantage du seeder ? Il va permettre de créer beaucoup de données en un rien de temps ! 50 Clients ? Aucun problème !</p><h3 id="autoriser-les-factories" tabindex="-1">Autoriser les factories <a class="header-anchor" href="#autoriser-les-factories" aria-label="Permalink to &quot;Autoriser les factories&quot;">​</a></h3><p>Pour permettre à votre Modèle d&#39;être « rempli », vous devez vérifier que la classe possède bien les use suivants (à mettre dans la classe du modèle) :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HasApiTokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HasFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Notifiable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><details class="details custom-block"><summary>Exemple</summary><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> App\\Models</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Illuminate\\Database\\Eloquent\\Factories\\HasFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Illuminate\\Database\\Eloquent\\Model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Illuminate\\Notifications\\Notifiable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Laravel\\Sanctum\\HasApiTokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HasApiTokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HasFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Notifiable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... le reste du code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="danger custom-block"><p class="custom-block-title">Attention aux imports</p><p>N&#39;oublier pas d&#39;importer les classes nécessaires pour utiliser les factories.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Illuminate\\Database\\Eloquent\\Factories\\HasFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Illuminate\\Notifications\\Notifiable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Laravel\\Sanctum\\HasApiTokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></details><p>⚠️ Sans cela, vous ne pourrez pas utiliser les factories.</p><h3 id="creer-une-factory" tabindex="-1">Créer une factory <a class="header-anchor" href="#creer-une-factory" aria-label="Permalink to &quot;Créer une factory&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make:factory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ClientFactory</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Je vous laisse configurer la factory (<code>/database/factories/ClientFactory.php</code>) en prenant exemple sur celle de la partie User. Mais dans les grandes lignes, il faut ajouter.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> definition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;nom&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">faker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">firstName,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;prenom&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">faker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lastName,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;email&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fake</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unique</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">safeEmail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;password&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> password_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">faker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">password, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PASSWORD_DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>La factory permet de générer un tableau associatif qui sera utilisé par le seeder pour créer les données.</p><p>La liste des options disponible pour fake est <a href="https://github.com/fzaninotto/Faker" target="_blank" rel="noreferrer">disponible ici</a></p><h3 id="definir-votre-seeder" tabindex="-1">Définir votre Seeder <a class="header-anchor" href="#definir-votre-seeder" aria-label="Permalink to &quot;Définir votre Seeder&quot;">​</a></h3><p>Éditer maintenant le DatabaseSeeder pour ajouter dans le run() :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">factory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:seed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Vous avez maintenant 50 clients dans votre table</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="et-les-produits" tabindex="-1">Et les Produits ? <a class="header-anchor" href="#et-les-produits" aria-label="Permalink to &quot;Et les Produits ?&quot;">​</a></h3><p>C&#39;est à vous que je vous laisse réaliser la même opération pour les produits.</p><div class="tip custom-block"><p class="custom-block-title">Aide</p><p>pour l&#39;image du produit, vous pouvez utiliser <a href="https://picsum.photos/200/300" target="_blank" rel="noreferrer">https://picsum.photos/200/300</a> pour générer des images aléatoires.</p></div><h2 id="creation-de-l-api" tabindex="-1">Création de l&#39;API <a class="header-anchor" href="#creation-de-l-api" aria-label="Permalink to &quot;Création de l&#39;API&quot;">​</a></h2><p>La création d&#39;une API va être très proche de ce que nous connaissons déjà. Première étape, créez un contrôleur ; pour rappel celui-ci permet de gérer le trafic et de répondre aux demandes des / du client.</p><p>Notre API sera très simple, elle contiendra <strong>3 routes / fonctionnalités</strong> :</p><table><thead><tr><th>Méthode</th><th>Chemin</th><th>Fonctionnalité</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/produits</code></td><td>Liste de l&#39;ensemble des produits</td></tr><tr><td>GET</td><td><code>/api/produit/{id}</code></td><td>Obtention du produit spécifié en paramètre <code>id</code></td></tr><tr><td>POST</td><td><code>/api/produit</code></td><td>Ajouter un nouveau produit dans la table <code>Produit</code></td></tr><tr><td>POST</td><td><code>/api/commande</code></td><td>Ajout d&#39;une commande nouvelle commande pour « un produit » et « un client »</td></tr></tbody></table><h2 id="testons-les-modeles" tabindex="-1">Testons les modèles <a class="header-anchor" href="#testons-les-modeles" aria-label="Permalink to &quot;Testons les modèles&quot;">​</a></h2><p>Vous avez maintenant à votre disposition l&#39;ensemble des modèles de votre base de données.</p><p>Les modèles seuls ne sont pas très utiles. Nous allons donc déclarer un contrôleur qui va nous permettre de les requêter.</p><h3 id="_1-creation-du-controleur" tabindex="-1">1. Création du contrôleur <a class="header-anchor" href="#_1-creation-du-controleur" aria-label="Permalink to &quot;1. Création du contrôleur&quot;">​</a></h3><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> artisan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make:controller</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ProduitsController</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-declarer-les-routes" tabindex="-1">2. Déclarer les routes <a class="header-anchor" href="#_2-declarer-les-routes" aria-label="Permalink to &quot;2. Déclarer les routes&quot;">​</a></h3><p>Nous allons créer une nouvelle route qui va nous permettre d&#39;appeler le <code>ProduitsController</code> et de récupérer l&#39;ensemble des produits.</p><p>Vu que nous réalisons une API REST, nous allons placer cette route dans le fichier <code>routes/api.php</code></p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Route</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/produits&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ProduitsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;liste&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="danger custom-block"><p class="custom-block-title">un instant ✋</p><p>En PHP objet il y a la notion de namespace, Laravel utilise de base les namespace, ça veut dire que nous allons avoir à utiliser le mot clé <code>use</code> pour importer (include). Quand vous voulez utiliser une classe qui n&#39;est pas dans le même fichier, il faudra déclarer l&#39;emplacement via un <code>use</code>. Exemple, pour que la classe <code>Demo</code> soit accessible depuis une autre classe, il faudra :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> App\\Models\\Demo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>⚠️ Si vous utilisez <strong>PHPStorm,</strong> cet import sera automatique.</li><li>⚠️ Si vous utilisez <strong>VSCode,</strong> il faudra passer par une extension <a href="https://marketplace.visualstudio.com/items?itemName=MehediDracula.php-namespace-resolver" target="_blank" rel="noreferrer">disponible ici</a></li></ul><p>Pour <strong>PHPStorm</strong>, alt+entrée permettra de déclencher l&#39;ajout dû use.</p><p>Pour <strong>VSCode</strong> je vous laisse regarder l&#39;usage de l&#39;extension :</p><p><img src="`+a+`" alt="Namespace Resolver" loading="lazy"></p></div><h3 id="_3-declarer-la-methode" tabindex="-1">3. Déclarer la méthode <a class="header-anchor" href="#_3-declarer-la-methode" aria-label="Permalink to &quot;3. Déclarer la méthode&quot;">​</a></h3><p>Si vous avez bien suivi, vous avez compris que nous allons devoir ajouter dans notre <code>ProduitsController</code> une méthode <code>liste</code>.</p><p>Dans votre contrôleur, ajouter le code suivant :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> liste</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>La méthode <code>response()-&gt;json()</code> permet de retourner un objet JSON. C&#39;est une méthode de Laravel qui permet de retourner un objet JSON.</p><p>Elle prend en paramètre un tableau associatif qui sera converti en JSON. Ici nous retournons l&#39;ensemble des produits. Pour cela nous utilisons la méthode <code>all()</code> qui permet de récupérer l&#39;ensemble des produits. Cette méthode est disponible sur tous les modèles.</p>`,90),c={class:"tip custom-block"},m=s("p",{class:"custom-block-title"},"Et oui !",-1),E=s("p",null,"C'est aussi simple que ça ! Avec cette simple méthode, vous avez écrit votre première API.",-1),g=s("iframe",{src:"https://giphy.com/embed/UtQHZEv5M7POO8t2WW",width:"280",height:"160",frameBorder:"0",class:"giphy-embed",allowFullScreen:""},null,-1),b=e(`<h3 id="_4-testons" tabindex="-1">4. Testons <a class="header-anchor" href="#_4-testons" aria-label="Permalink to &quot;4. Testons&quot;">​</a></h3><p>Pour tester, il suffit de lancer votre serveur et d&#39;aller sur la route <code>/api/produits</code>.</p><p>Pour tester, nous avons deux cas, soit vous avez un navigateur, soit vous avez un outil de requête HTTP.</p><h4 id="avec-un-navigateur" tabindex="-1">Avec un navigateur <a class="header-anchor" href="#avec-un-navigateur" aria-label="Permalink to &quot;Avec un navigateur&quot;">​</a></h4><p>Si vous avez un navigateur, vous pouvez aller sur la route <code>/api/produits</code> et vous devriez voir un tableau JSON.</p><h4 id="avec-un-outil-de-requete-http" tabindex="-1">Avec un outil de requête HTTP <a class="header-anchor" href="#avec-un-outil-de-requete-http" aria-label="Permalink to &quot;Avec un outil de requête HTTP&quot;">​</a></h4><p>Nous allons pouvoir le tester, pour tester les API c’est plutôt simple. Il suffit d’utiliser des outils tels que <a href="https://www.getpostman.com/" target="_blank" rel="noreferrer">Postman</a>, l’idée c’est de se construire un « cahier » de test vous permettant de valider le fonctionnement de votre application rapidement (comprendre dès que vous modifiez le code). C’est dans ce but que je vous ai préparé une collection de « tests » qui devrait vous permettre de valider rapidement le bon fonctionnement de vos API.</p><p>(Pssst! La création de comptes <strong>n&#39;est pas obligatoire</strong>) &lt;-- ⚠️⚠️</p><p>Ici nous allons utiliser un outil qui va nous permettre de faire des requêtes HTTP.</p><p>Cet outil s&#39;appelle <strong>Postman</strong> et est disponible <a href="https://www.postman.com/downloads/" target="_blank" rel="noreferrer">ici</a></p><p>Cette application va nous permettre de faire des requêtes HTTP et de voir les réponses. Elle est très pratique pour tester les API, c&#39;est un standard en entreprise.</p><p>Nous allons le tester ensemble.</p><ul><li>Lancez Postman</li><li>Créez une nouvelle requête</li><li>Dans la barre d&#39;adresse, tapez <code>http://localhost:8000/api/produits</code></li><li>Cliquez sur le bouton <code>Send</code></li></ul><p>Vous devriez voir une réponse de type <code>200</code> et un tableau JSON.</p><h2 id="point-etape-git" tabindex="-1">Point étape : GIT <a class="header-anchor" href="#point-etape-git" aria-label="Permalink to &quot;Point étape : GIT&quot;">​</a></h2><p>Et Git ? Vous avez oublié de faire un commit ? Pas de panique, vous pouvez toujours faire un commit avec les fichiers modifiés.</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Ajout de la route liste des produits&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="la-route-permettant-de-recuperer-un-produit-en-particulier" tabindex="-1">La route permettant de récupérer un produit en particulier <a class="header-anchor" href="#la-route-permettant-de-recuperer-un-produit-en-particulier" aria-label="Permalink to &quot;La route permettant de récupérer un produit en particulier&quot;">​</a></h2><p>Nous allons maintenant ajouter la route qui va nous permettre de récupérer un produit en particulier. Pour cela nous allons utiliser la méthode <code>find()</code> qui permet de récupérer un produit en particulier. Cette méthode prend en paramètre l&#39;identifiant du produit.</p><p>Je vous laisse écrire la route et la méthode dans le contrôleur.</p><div class="tip custom-block"><p class="custom-block-title">Rappel</p><p>Pour récupérer un produit en particulier, il faut utiliser la méthode <code>find()</code>. Exemple pour récupérer le produit avec l&#39;identifiant 1 :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Pour passer un paramètre à une route, il faut utiliser les accolades. Exemple pour une route qui prend un paramètre <code>id</code> :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Route</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/produits/{id}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ProduitsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;detail&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Le paramètre <code>id</code> sera accessible dans la méthode <code>detail</code> du contrôleur.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> detail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($id){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code permettant d&#39;obtenir le produit avec l&#39;identifiant $id (find($id))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><p>C&#39;est à vous, je vous laisse écrire le code et tester :</p><ul><li>Créez la route.</li><li>Créez la méthode dans le contrôleur.</li><li>Testez avec Postman (ou un navigateur).</li></ul><p>N&#39;oubliez pas de faire un commit si tout fonctionne.</p><h2 id="creer-un-nouveau-produit" tabindex="-1">Créer un nouveau produit <a class="header-anchor" href="#creer-un-nouveau-produit" aria-label="Permalink to &quot;Créer un nouveau produit&quot;">​</a></h2><p>Nous allons maintenant créer une route qui va nous permettre de créer un nouveau produit. Pour cela nous allons utiliser la méthode <code>create()</code> qui permet de créer un nouveau produit. Cette méthode prend en paramètre un tableau associatif qui contient les données du produit.</p><h3 id="_1-creer-la-route" tabindex="-1">1. Créer la route <a class="header-anchor" href="#_1-creer-la-route" aria-label="Permalink to &quot;1. Créer la route&quot;">​</a></h3><p>Pour créer une route, il faut utiliser la méthode <code>post()</code> de la classe <code>Route</code>. Cette méthode prend en paramètre l&#39;URL et la méthode du contrôleur à appeler.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Route</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/produits&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ProduitsController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ajouter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-creer-la-methode" tabindex="-1">2. Créer la méthode <a class="header-anchor" href="#_2-creer-la-methode" aria-label="Permalink to &quot;2. Créer la méthode&quot;">​</a></h3><p>Ajouter la méthode <code>ajouter</code> dans le contrôleur <code>ProduitsController</code>.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ajouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $produit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Produit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nom </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nom;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">description </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">description;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lien_image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lien_image;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prix;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tva </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tva;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $produit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($produit);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Cette méthode va créer un nouveau produit et le retourner en JSON. Pour cela nous utilisons la méthode <code>response()-&gt;json($produit)</code> qui prend en paramètre le produit à retourner.</p><p>Pour la création d&#39;un produit, nous créons un nouveau produit et nous lui assignons les valeurs des champs. Pour récupérer les valeurs des champs, nous utilisons la variable <code>$request</code> qui contient les données envoyées par le client. Pour récupérer une valeur.</p><h3 id="_3-tester" tabindex="-1">3. Tester <a class="header-anchor" href="#_3-tester" aria-label="Permalink to &quot;3. Tester&quot;">​</a></h3><p>Pour tester, vous devrez utiliser Postman. À votre avis pourquoi ?</p><p>Nous allons le réaliser ensemble, mais si vous le souhaitez, voilà la procédure :</p><ul><li>Créez une nouvelle requête</li><li>Dans la barre d&#39;adresse, tapez <code>http://localhost:8000/api/produits</code></li><li>Dans la partie, <code>Body</code> sélectionnez <code>raw</code> et <code>JSON</code></li><li>Dans la partie, <code>Body</code> tapez les données du produit à créer</li><li>Cliquez sur le bouton <code>Send</code></li></ul><p>Vous devriez voir une réponse de type <code>200</code> et le produit créé en JSON.</p><h2 id="point-etape-git-1" tabindex="-1">Point étape : GIT <a class="header-anchor" href="#point-etape-git-1" aria-label="Permalink to &quot;Point étape : GIT&quot;">​</a></h2><p>Et oui encore un commit…</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Ajout de la route création d&#39;un produit&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">pourquoi est-ce important ?</p><p>En cas de problème, vous pourrez revenir à un commit précédent et ainsi retrouver votre code.</p></div><h2 id="creer-une-nouvelle-commande" tabindex="-1">Créer une nouvelle commande <a class="header-anchor" href="#creer-une-nouvelle-commande" aria-label="Permalink to &quot;Créer une nouvelle commande&quot;">​</a></h2><p>Nous allons maintenant créer une route qui va nous permettre de créer une nouvelle commande. Pour cela nous allons utiliser la méthode <code>ajouterCommande()</code> qui permet de créer une nouvelle commande.</p><p>Je vous laisse écrire le code pour cette partie. En reprenant les étapes précédentes, vous devriez pouvoir :</p><ul><li>Créer la route (de type <code>post</code>, URL <code>/commandes</code>).</li><li>Créer la méthode dans le contrôleur (nom de la méthode <code>ajouterCommande</code>).</li><li>Écrire le code pour créer une nouvelle commande.</li></ul><div class="tip custom-block"><p class="custom-block-title">Rappel</p><p>Une commande est composée d&#39;un client et d&#39;un produit. Pour créer une commande, il faut donc un identifiant de client et un identifiant de produit.</p><p>Vous pouvez les passer en paramètre de la route ou les récupérer dans le corps de la requête. Exemple :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui prend en paramètre un identifiant de client et un identifiant de produit</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ajouterCommande</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient, $idProduit){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code permettant de créer une commande</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui récupère les identifiants de client et de produit dans le corps de la requête</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ajouterCommande</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $idClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">idClient;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $idProduit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">idProduit;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code permettant de créer une commande</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><h2 id="lister-toutes-les-commandes-d-un-client" tabindex="-1">Lister toutes les commandes d&#39;un client <a class="header-anchor" href="#lister-toutes-les-commandes-d-un-client" aria-label="Permalink to &quot;Lister toutes les commandes d&#39;un client&quot;">​</a></h2><p>Nous allons maintenant créer une route qui va nous permettre de lister toutes les commandes d&#39;un client. Pour cela nous allons utiliser la méthode <code>commandesClient()</code> qui permet de lister toutes les commandes d&#39;un client.</p><p>Je vous laisse écrire le code pour cette partie. En reprenant les étapes précédentes, vous devriez pouvoir :</p><ul><li>Créer la route (de type <code>get</code>, URL <code>/commandes/{idClient}</code>).</li><li>Créer la méthode dans le contrôleur (nom de la méthode <code>commandesClient</code>).</li><li>Écrire le code pour lister toutes les commandes d&#39;un client.</li></ul><div class="danger custom-block"><p class="custom-block-title">Un instant</p><p>Où allons-nous ranger cette méthode ? Dans le contrôleur <code>CommandesController</code> ou dans le contrôleur <code>ClientsController</code> ?</p><ul><li>Si vous avez choisi <code>CommandesController</code>, vous avez raison.</li></ul><p>Pourquoi ? Parce que nous listons les commandes d&#39;un client. Donc nous devons aller chercher les commandes dans le contrôleur <code>CommandesController</code>.</p><p>En utilisant l&#39;aide mémoire, je vous laisse créer le contrôleur <code>CommandesController</code> et la méthode <code>commandesClient()</code>.</p></div><div class="tip custom-block"><p class="custom-block-title">Rappel</p><p>Un client possède plusieurs commandes. Pour lister les commandes d&#39;un client, il faut donc un identifiant de client.</p><p>Vous pouvez le passer en paramètre de la route ou le récupérer dans le corps de la requête. Exemple :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui prend en paramètre un identifiant de client</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> commandesClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code permettant de lister les commandes d&#39;un client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><h3 id="obtenir-les-commandes-d-un-client" tabindex="-1">Obtenir les commandes d&#39;un client <a class="header-anchor" href="#obtenir-les-commandes-d-un-client" aria-label="Permalink to &quot;Obtenir les commandes d&#39;un client&quot;">​</a></h3><p>Un peu d&#39;aide pour cette partie. Pour obtenir toutes les commandes d&#39;un client, nous allons utiliser la méthode <code>commandes()</code> qui permet de récupérer les commandes d&#39;un client.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui récupère toutes les commandes d&#39;un client</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> commandesClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commandes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Nous passons ici par le modèle <code>Client</code> pour récupérer les commandes d&#39;un client. Pourquoi ? Parce que nous avons défini une relation entre le modèle <code>Client</code> et le modèle <code>Commande</code>. Cette relation permet de récupérer les commandes d&#39;un client.</p><p>Mais nous pouvons également récupérer les produits de chaque commande. Pour cela, nous allons utiliser la méthode <code>with()</code> qui permet de récupérer les produits d&#39;une commande.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui récupère toutes les commandes d&#39;un client avec les produits de chaque commande</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> commandesClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commandes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;produit&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Il est également possible de passer directement via le modèle <code>Commande</code> pour récupérer les commandes d&#39;un client. Pour cela, nous allons utiliser la méthode <code>where()</code> qui permet de filtrer les résultats. Comme présenté dans la solution alternative suivante.</p><h3 id="obtenir-les-produits-commandes-par-un-client-solution-alternative" tabindex="-1">Obtenir les produits commandés par un client solution alternative <a class="header-anchor" href="#obtenir-les-produits-commandes-par-un-client-solution-alternative" aria-label="Permalink to &quot;Obtenir les produits commandés par un client solution alternative&quot;">​</a></h3><p>Un peu d&#39;aide pour cette partie. Pour obtenir toutes les commandes d&#39;un client, nous allons utiliser la méthode <code>where()</code> qui permet de filtrer les résultats. Cette méthode prend en paramètre le nom du champ et la valeur à filtrer.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui récupère toutes les commandes d&#39;un client</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> commandesClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Commande</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id_client&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $idClient)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Cette méthode va nous retourner un tableau JSON contenant toutes les commandes du client. Mais ce n&#39;est pas très pratique. Nous voudrions plutôt avoir un tableau JSON contenant les produits commandés par le client.</p><p>Pour cela nous allons utiliser la méthode <code>with()</code> qui permet de récupérer les données d&#39;une autre table. Cette méthode prend en paramètre le nom de la table à récupérer.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui récupère toutes les commandes d&#39;un client</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> commandesClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idClient){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Commande</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id_client&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $idClient)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;produit&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Je vous laisse observer la différence entre les deux réponses.</p><div class="tip custom-block"><p class="custom-block-title"><code>with()</code></p><p>Le <code>with()</code> permet de récupérer les données d&#39;une autre table. Vous pouvez également déclarer le <code>with()</code> dans le modèle.</p><p>Exemple, <strong>dans le modèle <code>Commande</code></strong> :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$with </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;produit&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>En indiquant le <code>$with</code> dans le modèle, votre jointure sera automatiquement effectuée. Vous n&#39;aurez plus besoin de passer par le <code>with()</code> dans le contrôleur. Pratique pour automatiser les jointures.</p></div><details class="details custom-block"><summary>Qu&#39;avez-vous observé ?</summary><ul><li>La première réponse contient les commandes du client.</li><li>La deuxième réponse contient les commandes du client et les produits commandés.</li></ul></details><h2 id="supprimer-une-commande" tabindex="-1">Supprimer une commande <a class="header-anchor" href="#supprimer-une-commande" aria-label="Permalink to &quot;Supprimer une commande&quot;">​</a></h2><p>Nous allons maintenant créer une route qui va nous permettre de supprimer une commande. Pour cela nous allons utiliser la méthode <code>supprimerCommande()</code> qui permet de supprimer une commande.</p><p>Je vous laisse écrire le code pour cette partie. En reprenant les étapes précédentes, vous devriez pouvoir :</p><ul><li>Créer la route (de type <code>delete</code>, URL <code>/commandes/{idCommande}</code>).</li><li>Créer la méthode dans le contrôleur (nom de la méthode <code>supprimerCommande</code>).</li><li>Écrire le code pour supprimer une commande.</li></ul><div class="tip custom-block"><p class="custom-block-title">Rappel</p><p>Pour supprimer une commande, il faut un identifiant de commande.</p><p>Vous pouvez le passer en paramètre de la route ou le récupérer dans le corps de la requête. Exemple :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui prend en paramètre un identifiant de commande</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> supprimerCommande</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($idCommande){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code permettant de supprimer une commande</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Eloquent nous permet de supprimer une commande en utilisant la méthode <code>destroy()</code> qui prend en paramètre l&#39;identifiant de la commande à supprimer.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui supprime une commande. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Cette méthode prend en paramètre un identifiant de commande et supprime la commande correspondante (si elle existe, sinon elle ne fait rien)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dans cette exemple, nous supprimons la commande dont l&#39;identifiant est 1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Commande</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><h2 id="creer-un-client" tabindex="-1">Créer un client <a class="header-anchor" href="#creer-un-client" aria-label="Permalink to &quot;Créer un client&quot;">​</a></h2><p>Nous allons maintenant créer une route qui va nous permettre de créer un client. Pour cela nous allons utiliser la méthode <code>creerClient()</code> qui permet de créer un client.</p><p>Je vous laisse écrire le code pour cette partie. En reprenant les étapes précédentes, vous devriez pouvoir :</p><ul><li>Créer la route (de type <code>post</code>, URL <code>/api/client</code>).</li><li>Créer la méthode dans le contrôleur (nom de la méthode <code>creerClient</code>).</li><li>Écrire le code pour créer un client.</li></ul><div class="tip custom-block"><p class="custom-block-title">Rappel</p><p>Pour créer un client, il faut un nom, un prénom et un email et un mot de passe.</p><p>Vous pouvez passer ces informations en paramètre de la route ou les récupérer dans le corps de la requête. Exemple :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui prend en paramètre un nom, un prénom, un email et un mot de passe</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> creerClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code permettant de créer un client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // $request-&gt;nom, $request-&gt;prenom, $request-&gt;email, $request-&gt;motDePasse</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>⚠️ Attention, il faut vérifier que l&#39;email n&#39;est pas déjà utilisé par un autre client. Si c&#39;est le cas, il faut retourner une erreur. Il faudra également vérifier que le mot de passe fait au moins 8 caractères.</p><p>Attention également à bien hasher le mot de passe avant de l&#39;enregistrer dans la base de données.</p></div><h2 id="authentification-d-un-client" tabindex="-1">Authentification d&#39;un client <a class="header-anchor" href="#authentification-d-un-client" aria-label="Permalink to &quot;Authentification d&#39;un client&quot;">​</a></h2><p>Nous allons maintenant créer une route qui va nous permettre d&#39;authentifier un client. Pour cela nous allons utiliser la méthode <code>authentifierClient()</code> qui permet d&#39;authentifier un client.</p><p>Je vous laisse écrire le code pour cette partie. En reprenant les étapes précédentes, vous devriez pouvoir :</p><ul><li>Créer la route (de type <code>post</code>, URL <code>/client/authentification</code>).</li><li>Créer la méthode dans le contrôleur (nom de la méthode <code>authentifierClient</code>).</li><li>Écrire le code pour authentifier un client.</li><li>Retourner le client authentifié.</li></ul><div class="tip custom-block"><p class="custom-block-title">Rappel</p><p>Pour authentifier un client, il faut un email et un mot de passe.</p><p>Vous pouvez passer ces informations en paramètre de la route ou les récupérer dans le corps de la requête. Exemple :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Exemple de méthode qui prend en paramètre un email et un mot de passe</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> authentifierClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code permettant d&#39;authentifier un client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // $request-&gt;email, $request-&gt;motDePasse</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Vous allez devoir utiliser password_verify() pour vérifier le mot de passe.</p><p>⚠️ N&#39;oublier pas de retourner le client authentifié.</p></div><h2 id="aller-plus-loin" tabindex="-1">Aller plus loin <a class="header-anchor" href="#aller-plus-loin" aria-label="Permalink to &quot;Aller plus loin&quot;">​</a></h2><p>Pour aller plus loin dans la partie API, vous pouvez :</p><ul><li>Utiliser <code>sanctum</code> pour créer des tokens d&#39;authentification. &lt;<a href="https://laravel.com/docs/10.x/sanctum" target="_blank" rel="noreferrer">https://laravel.com/docs/10.x/sanctum</a></li><li>Utilisez-les <code>abilities</code> pour gérer les droits d&#39;accès. <a href="https://laravel.com/docs/10.x/sanctum#token-abilities" target="_blank" rel="noreferrer">https://laravel.com/docs/10.x/sanctum#token-abilities</a></li></ul><p>Sanctum, c&#39;est un package (un peu comme Breeze), mais ici pas d&#39;interface, nous avons « juste » la logique pour :</p><ul><li>Créer des tokens d&#39;authentification (<code>$token = $request-&gt;user()-&gt;createToken($request-&gt;token_name);</code>)</li><li>Gérer les droits d&#39;accès pour chaque route (<code>-&gt;middleware(&#39;auth:sanctum&#39;)</code>)</li><li>Authentifier les utilisateurs via un token (appelé bearer token).</li></ul><div class="tip custom-block"><p class="custom-block-title">C&#39;est du bonus</p><p>Cette partie n&#39;intéressera pas tout le monde. Si vous êtes intéressé, vous pouvez regarder la documentation de Sanctum. Et me demander si vous avez des questions.</p></div><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>Nous avons maintenant terminé la partie API. Nous avons vu comment créer des routes, des contrôleurs et des modèles. Nous avons aussi vu comment utiliser les méthodes <code>get()</code>, <code>post()</code>, <code>put()</code> et <code>delete()</code> pour créer des routes.</p><p>En Bonus, nous avons aussi vu comment utiliser les méthodes <code>where()</code> et <code>with()</code> pour filtrer les résultats. Nous avons également vu comment il était possible de sécuriser nos routes avec Laravel Sanctum.</p><p>Nous allons maintenant passer à la partie Frontend. Nous allons créer une application web ou mobile qui va nous permettre de gérer nos commandes et nos clients.</p><p>Ne vous inquiétez pas, pour réaliser notre client, nous utiliserons deux frameworks simple et puissant :</p><ul><li>Vue.js pour le Frontend</li><li>Flutter pour le Mobile</li></ul><p>Vous avez un exemple d&#39;application <a href="/tp/flutter/sample_code.html">Flutter utilisant une API</a>. Vous pouvez vous en inspirer pour réaliser votre application.</p>`,98),y=s("iframe",{src:"https://giphy.com/embed/m9eG1qVjvN56H0MXt8",width:"295",height:"480",frameBorder:"0",class:"giphy-embed",allowFullScreen:""},null,-1);function v(F,C,A,f,D,q){const i=p("center");return h(),l("div",null,[k,s("div",c,[m,E,t(i,null,{default:r(()=>[g]),_:1})]),b,y])}const L=n(u,[["render",v]]);export{_ as __pageData,L as default};
