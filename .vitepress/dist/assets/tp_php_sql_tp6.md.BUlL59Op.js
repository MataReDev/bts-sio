import{_ as s}from"./chunks/uml-connexion.DdRkL_eX.js";import{_ as i,c as a,o as e,U as n}from"./chunks/framework.aGaNZw_P.js";const l="/assets/maquette.CScoFUkX.png",b=JSON.parse('{"title":"Greta TV - Administrable","description":"","frontmatter":{},"headers":[],"relativePath":"tp/php/sql/tp6.md","filePath":"tp/php/sql/tp6.md","lastUpdated":1613477287000}'),t={name:"tp/php/sql/tp6.md"},p=n('<h1 id="greta-tv-administrable" tabindex="-1">Greta TV - Administrable <a class="header-anchor" href="#greta-tv-administrable" aria-label="Permalink to &quot;Greta TV - Administrable&quot;">‚Äã</a></h1><p>Dans ce TP nous allons mettre en pratique nos connaissances autour de la base de donn√©es. Nous allons mettre en place une base de donn√©es nous permettant de rendre administrable :</p><ul><li>La liste des vid√©os.</li><li>Le th√®me en fonction de la vid√©o.</li></ul><h2 id="premiere-etape-definir-le-besoin" tabindex="-1">Premi√®re √©tape d√©finir le besoin <a class="header-anchor" href="#premiere-etape-definir-le-besoin" aria-label="Permalink to &quot;Premi√®re √©tape d√©finir le besoin&quot;">‚Äã</a></h2><p>La premi√®re √©tape dans tous les projets est la d√©finition du besoin. Vous devez avec la personne qui vous demande une mission comprendre ce qu&#39;il attend (moi en l&#39;occurence dans ce projet). Je souhaite donc rendre administrable l&#39;application Greta TV.</p><p>En effet, la premi√®re version de l&#39;application est statique, nous avons utilis√© le PHP pour int√©grer des vid√©os dans une page nomm√©e <code>tv.php</code>. Cette page prend en param√®tre un identifiant de vid√©o, et potentiellement un th√®me si vous aviez int√©gr√© cette fonctionnalit√©.</p><p>Je souhaite que nous allions plus loin ! Notre application doit maintenant √™tre administrable afin de rendre la liste des vid√©os sur la page <code>index.php</code> dynamique en fonction <strong>de donn√©es pr√©sentes en base de donn√©es</strong>. En plus de cette interface dynamique, je souhaite que vous ajoutiez une page d&#39;administration permettant l&#39;ajout de lien dans la base de donn√©es.</p><p>Je r√©sume le besoin √† int√©grer :</p><ul><li>Cr√©ation d&#39;une base de donn√©es avec la liste des liens √† afficher.</li><li>Utilisation de la base de donn√©es sur la page d&#39;accueil.</li><li>Utilisation de la base de donn√©es sur la page <code>tv.php</code> pour ne plus utiliser l&#39;ID Google, mais l&#39;identifiant interne de la vid√©o √† voir.</li><li>Cr√©ation d&#39;une page ¬´ d&#39;admin ¬ª permettant l&#39;ajout de vid√©o. (Cette page ne sera pas accessible √† tous).</li><li>Les vid√©os <strong>doivent √™tre</strong> li√© √† l&#39;utilisateur actuellement connect√©. (√ßa veux dire une cl√© √©trang√®re).</li></ul><h2 id="creer-le-mcd" tabindex="-1">Cr√©er le MCD <a class="header-anchor" href="#creer-le-mcd" aria-label="Permalink to &quot;Cr√©er le MCD&quot;">‚Äã</a></h2><p>La premi√®re √©tape avant de commencer la cr√©ation de la base de donn√©es est la r√©alisation du MCD. Je vous laisse travailler sur le sujet. Pour ma part j&#39;ai d√©fini <strong>deux tables</strong>.</p><div class="tip custom-block"><p class="custom-block-title">N&#39;oubliez pas</p><p>N&#39;oubliez pas les cl√©s ! Un enregistrement de base de donn√©es <strong>doit poss√©der une cl√© unique</strong> (id√©alement autog√©n√©r√© comme vu ensemble).</p></div><p>C&#39;est √† vous ! Je vous laisse travailler le sujet.</p><h2 id="creer-la-base-de-donnees" tabindex="-1">Cr√©er la base de donn√©es <a class="header-anchor" href="#creer-la-base-de-donnees" aria-label="Permalink to &quot;Cr√©er la base de donn√©es&quot;">‚Äã</a></h2><p>Maintenant que votre mod√®le de base de donn√©es est r√©alis√©, nous allons passer √† la cr√©ation de la base de donn√©es √† partir du MCD. Pour cette √©tape vous avez deux possibilit√©s :</p><ul><li>Via phpMyAdmin</li><li>Via dbeaver</li></ul><p>Je vous laisse travailler. Je vous rappelle que <strong>vous devez mettre des cl√©s</strong> pour vos enregistrements comme d√©finis dans votre MCD.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Pour valider votre base de donn√©es, je vous laisse cr√©er des donn√©es fictives. R√©aliser cette op√©ration directement via phpMyAdmin (ou dbeaver).</p></div><h2 id="inserer-un-jeu-de-test" tabindex="-1">Ins√©rer un jeu de test <a class="header-anchor" href="#inserer-un-jeu-de-test" aria-label="Permalink to &quot;Ins√©rer un jeu de test&quot;">‚Äã</a></h2><p>Pour commencer nous allons ins√©rer des donn√©es.</p><div class="danger custom-block"><p class="custom-block-title">LES MOT NE DOIVENT PAS √äTRE EN CLAIR</p><p>Vous ne devez <strong>JAMAIS</strong> avoir un mot de passe en clair en base de donn√©es.</p><p>Vous pouvez par exemple utiliser la fonction SQL <code>SHA2(&quot;VotreMotDePasse-SALT-SECRET&quot;, 512)</code>. Cela g√©n√®rera un mot de passe ¬´ hasher ¬ª √©quivalent au mot de passe.</p><p>Exemple d&#39;insertion :</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;valentin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SHA2(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;VotreMotDePasse-SALT-SECRET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Exemple de v√©rification si l&#39;utilisateur existe :</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;valentin&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SHA2(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;VotreMotDePasse-SALT-SECRET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>S‚Äôil y a un r√©sultat, c&#39;est que votre utilisateur existe et a fourni le bon mot de passe.</p></div><h2 id="creer-la-page-¬´-d-administration-¬ª" tabindex="-1">Cr√©er la page ¬´ d&#39;administration ¬ª. <a class="header-anchor" href="#creer-la-page-¬´-d-administration-¬ª" aria-label="Permalink to &quot;Cr√©er la page ¬´ d&#39;administration ¬ª.&quot;">‚Äã</a></h2><p>Afin de cr√©er cette page d&#39;administration, nous allons avoir besoin d&#39;une page de connexion. En effet l&#39;administration du site ne doit pas √™tre ouverte √† tous, seuls les gens poss√©dant un compte peuvent administrer la liste des vid√©os.</p><p>La page devant √™tre prot√©g√©e, vous devez mettre en place une m√©canique comme :</p><p><img src="'+s+`" alt="ceci est la m√©canique de connexion" loading="lazy"></p><h3 id="etape-1-creation-de-la-page-de-connexion" tabindex="-1">√âtape 1 : Cr√©ation de la page de connexion <a class="header-anchor" href="#etape-1-creation-de-la-page-de-connexion" aria-label="Permalink to &quot;√âtape 1 : Cr√©ation de la page de connexion&quot;">‚Äã</a></h3><p>En vous inspirant de <a href="/cheatsheets/php/#gestion-basique-d-une-authentification-¬´-simple-¬ª">l&#39;aide m√©moire PHP</a>, je vous laisse √©crire le code permettant :</p><ul><li>D&#39;afficher le formulaire de saisie des informations.</li><li>V√©rifier que les valeurs saisie (en POST) sont correctes.</li><li>Redirig√© vers la page de gestion de vid√©os (<code>header(&#39;location: ‚Ä¶&#39;);</code>)</li></ul><p>üëπ N&#39;oubliez pas l&#39;organisation üëπ (nous allons ici cr√©er que la <code>page</code> faisant le traitement).</p><div class="tip custom-block"><p class="custom-block-title">Deux solutions sont possibles</p><p>Pour g√©rer les droits d&#39;acc√®s vous avez deux solutions :</p><ul><li>G√©rer les droits dans l&#39;<code>index.php</code> pour avoir une <code>$whiteliste</code> diff√©rentes en fonction des droits. (c&#39;est ma solution favorite).</li><li>G√©rer les droits dans chaque page. (Risqu√© √† mon sens).</li></ul></div><details class="details custom-block"><summary>Vous s√©chez pour la partie requ√™te SQL ?</summary><p>Pour valider l&#39;authentification, vous devez √©crire quelque chose comme :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($_POST[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($_POST[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // V√©rification si l&#39;utilisateur existe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $stmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $pdo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prepare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> login=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> password=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SHA2(?, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $stmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([$_POST[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], $_POST[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $stmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\PDO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FETCH_ASSOC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // La personne existe en base de donn√©es (nous allons donc la connecter)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($users) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // R√©ussite de la connexion, on sauvegarde dans la SESSION les informations.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            $_SESSION[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $users[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Sauvegarde le premier utilisateur</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;location: / &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            die</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Action en cas d&#39;echec de connexion</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></details><h3 id="ajouter-les-boutons-dans-la-barre" tabindex="-1">Ajouter les boutons dans la barre <a class="header-anchor" href="#ajouter-les-boutons-dans-la-barre" aria-label="Permalink to &quot;Ajouter les boutons dans la barre&quot;">‚Äã</a></h3><p>Maintenant que nous avons la connexion d&#39;effective. Nous allons ajouter dans la barre (navbar) deux boutons :</p><ul><li>Connexion</li><li>D√©connexion</li></ul><p>Les deux boutons doivent √™tre affich√© si l&#39;utilisateur est connect√© ou non, nous allons donc √©crire :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($_SESSION[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // La session existe, nous sommes donc connect√©</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&lt;a href=&#39;index.php?page=logout&#39;&gt;D√©connexion&lt;/a&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Non connect√©</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&lt;a href=&#39;index.php?page=login&#39;&gt;Connexion&lt;/a&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">O√π mettre le code ?</p><p>Je veux que les boutons s&#39;affiche dans la NavBar. Donc le code doit-√™tre‚Ä¶ Dans la NavBar!</p></div><h3 id="etape-3-page-de-deconnexion" tabindex="-1">√âtape 3 : Page de d√©connexion <a class="header-anchor" href="#etape-3-page-de-deconnexion" aria-label="Permalink to &quot;√âtape 3 : Page de d√©connexion&quot;">‚Äã</a></h3><p>La page de d√©connexion va avoir comme role de ¬´ supprimer la session ¬ª. Il faut donc cr√©er une page, celle-ci contiendra au minimum le code suivant :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">session_destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>üëÄ Je vous laisse √©crire la suite</p><h3 id="etape-4-creeer-la-page-de-gestion-des-videos" tabindex="-1">√âtape 4 : Cr√©√©er la page de gestion des vid√©os <a class="header-anchor" href="#etape-4-creeer-la-page-de-gestion-des-videos" aria-label="Permalink to &quot;√âtape 4 : Cr√©√©er la page de gestion des vid√©os&quot;">‚Äã</a></h3><p>Pour la page de gestion des vid√©os, je vous propose de r√©aliser une page ressemblant √† ceci :</p><p><img src="`+l+`" alt="Maquette" loading="lazy"></p><p>Commencer par la r√©alisation de la page en HTML. Nous ajouterons par la suite les requ√™tes SQL.</p><h2 id="modifier-la-page-d-accueil-pour-utiliser-la-base-de-donnees" tabindex="-1">Modifier la page d&#39;accueil pour utiliser la base de donn√©es <a class="header-anchor" href="#modifier-la-page-d-accueil-pour-utiliser-la-base-de-donnees" aria-label="Permalink to &quot;Modifier la page d&#39;accueil pour utiliser la base de donn√©es&quot;">‚Äã</a></h2><p>Modifier la page d&#39;accueil de votre site afin de r√©aliser la requ√™te SQL permettant de r√©cup√©rer l&#39;ensemble des vid√©os pr√©sentes en base de donn√©es. Utiliser le r√©sultat afin d&#39;afficher les vid√©os.</p><details class="details custom-block"><summary>Vous s√©chez ?</summary><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./utils/db.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $pdo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> videos&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\PDO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FETCH_ASSOC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // $results contient maintenant l&#39;ensemble de vos vid√©os pr√©sent en base de donn√©es. Pour l&#39;afficher, il vous suffit de faire une boucle.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details><h2 id="modifier-la-page-tv-php-pour-utiliser-la-base-de-donnees" tabindex="-1">Modifier la page <code>tv.php</code> pour utiliser la base de donn√©es <a class="header-anchor" href="#modifier-la-page-tv-php-pour-utiliser-la-base-de-donnees" aria-label="Permalink to &quot;Modifier la page \`tv.php\` pour utiliser la base de donn√©es&quot;">‚Äã</a></h2><p>Pour cette √©tape vous avez deux solutions :</p><ul><li>Ne rien modifier, et continuer √† utiliser l&#39;ID de YouTube comme identifiant (<strong>ATTENTION</strong>, votre code est donc vuln√©rable √† l&#39;injection de param√®tres !!).</li><li>Modifier, pour passer l&#39;identifiant <strong>interne</strong> de la vid√©o que vous souhaitez afficher. Cet identifiant vous permettra de faire une requ√™te du type :</li></ul><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // L&#39;utilisateur acc√®de √† =&gt;  http://localhost/index.php?page=tv&amp;id=1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $stmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $pdo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prepare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $stmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([$_GET[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ID re√ßu en param√®tre</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $stmt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\PDO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FETCH_ASSOC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // La vid√©o demand√© n&#39;existe pas.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$videos){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // On redirige l&#39;utilisateur vers la home</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location: ./&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        die</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // $video contient les informations de la vid√©o √† afficher</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $video </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $videos[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;!--</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> La</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> suite</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> de</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> votre</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">celle</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> qui</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> affiche</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> la</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vid√©o</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> --&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>C&#39;est √† vous !</p>`,53),r=[p];function h(d,k,o,u,c,E){return e(),a("div",null,r)}const y=i(t,[["render",h]]);export{b as __pageData,y as default};
