import{_ as e,c as i,o as s,U as a}from"./chunks/framework.aGaNZw_P.js";const n="/assets/build.CnG9uHP4.png",g=JSON.parse('{"title":"Les Dockerfile’s","description":"Comme nous l’avons chaque image Docker repose sur un fichier Dockerfile. Pour l’instant, nous n’avons pas écrit le nôtre, nous avons juste utilisé ceux fournis sur le DockerHub. Dans ce TP nous allons voir la structure d’un fichier Dockerfile, et vous allez écrire votre premier Dockerfile. Il aura pour but de définir l’ensemble de la « stack applicative » nécessaire au bon fonctionnement de l’application « TODO ».","frontmatter":{"description":"Comme nous l’avons chaque image Docker repose sur un fichier Dockerfile. Pour l’instant, nous n’avons pas écrit le nôtre, nous avons juste utilisé ceux fournis sur le DockerHub. Dans ce TP nous allons voir la structure d’un fichier Dockerfile, et vous allez écrire votre premier Dockerfile. Il aura pour but de définir l’ensemble de la « stack applicative » nécessaire au bon fonctionnement de l’application « TODO »."},"headers":[],"relativePath":"tp/docker/dockerfile.md","filePath":"tp/docker/dockerfile.md","lastUpdated":1678129240000}'),r={name:"tp/docker/dockerfile.md"},l=a(`<h1 id="les-dockerfile-s" tabindex="-1">Les Dockerfile’s <a class="header-anchor" href="#les-dockerfile-s" aria-label="Permalink to &quot;Les Dockerfile’s&quot;">​</a></h1><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>Comme nous l’avons vu dans <a href="./introduction.html">le premier TP</a> chaque image Docker repose sur un fichier Dockerfile. Pour l’instant, nous n’avons pas écrit le nôtre, nous avons juste utilisé ceux fournis sur le DockerHub. Dans ce TP nous allons voir la structure d’un fichier Dockerfile, et vous allez écrire votre premier Dockerfile. Il aura pour but de définir l’ensemble de la « stack applicative » nécessaire au bon fonctionnement de l’application « TODO ».</p><h2 id="pourquoi-faire-des-dockerfile" tabindex="-1">Pourquoi faire des Dockerfile <a class="header-anchor" href="#pourquoi-faire-des-dockerfile" aria-label="Permalink to &quot;Pourquoi faire des Dockerfile&quot;">​</a></h2><p>Comme vous avez pu le voir sur le DockerHub il existe énormément d’images déjà prêtes, elles nous seront bien évidement utiles dans nos images Docker, mais tels quelles elles n’ont que « peu d’intérêts ». Nous allons donc écrire un fichier Dockefile qui va permettre de créer toute la définition pour le bon fonctionnement de l’application « TODO » que vous avez écrit dans un autre TP.</p><p>Une fois le fichier Dockerfile écrit, votre application sera fonctionnelle sur toutes les plateformes supportées par Docker (Windows, Linux, OSX, Raspberry Pi…), fonctionnelles oui, mais surtout fonctionnel en quelques secondes !</p><h2 id="creer-un-dockerfile" tabindex="-1">Créer un Dockerfile <a class="header-anchor" href="#creer-un-dockerfile" aria-label="Permalink to &quot;Créer un Dockerfile&quot;">​</a></h2><p>Les « Dockerfile » sont des simples fichiers textes, mais avec un formalisme précis. Par exemple :</p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> alpine:latest</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Valentin Brosseau </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;c4software@gmail.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;echo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mon premier Dockerfile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Avant de « builder » cette première image, arrêtons-nous sur les différentes lignes :</p><ul><li>« FROM alpine:latest », c’est l’image de référence, dans le cas présent une image très légère (un linux avec très peu de dépendances).</li><li>« LABEL Valentin Brosseau &quot;<a href="mailto:c4software@gmail.com" target="_blank" rel="noreferrer">c4software@gmail.com</a>&quot; », le mainteneur de l’image (purement indicatif).</li><li>« ENTRYPOINT [&quot;echo&quot;, &quot;&#39;Mon premier Dockerfile&#39;&quot;] », la commande qui sera lancée au <strong>démarrage</strong> de votre image.</li></ul><p>Pour finir, enregistrer la définition précédente dans un fichier nommé « Dockerfile ».</p><h2 id="builder-votre-image" tabindex="-1">Builder votre image <a class="header-anchor" href="#builder-votre-image" aria-label="Permalink to &quot;Builder votre image&quot;">​</a></h2><p>Pour builder votre image il suffit de lancer la commande suivante :</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;docker-hello:latest&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Avant de lancer cette commande, regardons les différents éléments :</p><ul><li>« --tag &quot;docker-hello&quot; », c’est le nom de votre image.</li><li>« …:latest », c’est la version de votre image. Latest indique la version la plus récente.</li><li>« . » indique à Docker que le fichier Dockerfile est dans le dossier courant.</li></ul><p>Lancer la précédente commande dans le dossier où vous avez créé le fichier Dockerfile.</p><p><img src="`+n+`" alt="exemple build" loading="lazy"></p><h2 id="image-docker-pour-l-application-todo" tabindex="-1">Image Docker pour l’application &quot;TODO&quot; <a class="header-anchor" href="#image-docker-pour-l-application-todo" aria-label="Permalink to &quot;Image Docker pour l’application &quot;TODO&quot;&quot;">​</a></h2><p>Faire un test c’est bien! Mais maintenant que l’on connaît les bases d’une image Docker, nous allons créer une image Docker qui va nous permettre de lancer rapidement (et très simplement) l’application sans avoir à nous soucier de l’environnement sur lequel vous allez lancer « votre application / site web ».</p><h3 id="_1-ecriture-du-dockerfile" tabindex="-1">1. Écriture du Dockerfile <a class="header-anchor" href="#_1-ecriture-du-dockerfile" aria-label="Permalink to &quot;1. Écriture du Dockerfile&quot;">​</a></h3><p>Pour écrire notre Dockerfile nous allons avoir besoin de connaître les technologies nécessaires au bon fonctionnement de notre application. Dans notre cas, il faut le langage de programmation de la partie serveur :</p><ul><li>[…] (À vous de trouver…)</li></ul><p>Une fois que c’est fait, il faut trouver une image de base qui nous servira de référence. Dans notre cas … PHP. Une image officielle existe : <a href="https://hub.docker.com/_/php/" target="_blank" rel="noreferrer">Docker Hub PHP</a>.</p><ul><li>Quelle version choisissez-vous ?</li><li>Pourquoi ?</li></ul><p>Pour continuer, nous allons utiliser l’image PHP 8 Apache. Voilà le début de notre Dockerfile :</p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> php:7-apache</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MAINTAINER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Valentin Brosseau </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;c4software@gmail.com&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>La base de votre Dockerfile est terminée. Nous allons voir comment ajouter le code source dans l’image.</p><h3 id="_2-ajout-des-sources-dans-l-image" tabindex="-1">2. Ajout des sources dans l’image <a class="header-anchor" href="#_2-ajout-des-sources-dans-l-image" aria-label="Permalink to &quot;2. Ajout des sources dans l’image&quot;">​</a></h3><p>Nous avons vu dans le premier TP qu’il était possible de faire un « montage ». C’est pratique, pour ajouter de la donnée temporaire, mais dans le cas présent ce que l’on veut c’est faire une image statique qui sera transportable nous allons donc utiliser la commande <code>COPY</code>.</p><p>La commande <code>COPY</code> permet de copier des fichiers (dossiers, fichiers, etc.) directement dans l’image qui sera construite. Une fois « builder » les données seront persistantes et les modifications seront effacées à chaque redémarrage de l’image (intéressant d’un point de vue de la sécurité).</p><p>La commande <code>COPY</code> prend deux arguments le fichier « sources » et la destination dans votre image. Modifions le fichier Dockerfile pour ajouter la commande <code>COPY</code> suivante :</p><div class="language-dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> php:8-apache</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MAINTAINER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Valentin Brosseau </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;c4software@gmail.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> src/ /var/www/html/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Le premier dossier c’est vos sources, sur votre machine dans le même dossier que le fichier Dockerfile, créez un dossier nommé <code>src</code> avec à l’intérieur les sources de votre projet <code>todo-php</code>.</p><p>Et voilà! C’est terminé. Votre image est prête à être « build ».</p><h3 id="_3-build-de-l-image" tabindex="-1">3. Build de l’image <a class="header-anchor" href="#_3-build-de-l-image" aria-label="Permalink to &quot;3. Build de l’image&quot;">​</a></h3><p>Maintenant que notre image est prête, nous allons pouvoir builder l’image :</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;php-todo:latest&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Ding ! C’est prêt.</p><h3 id="_4-lancer-votre-application" tabindex="-1">4. Lancer votre application <a class="header-anchor" href="#_4-lancer-votre-application" aria-label="Permalink to &quot;4. Lancer votre application&quot;">​</a></h3><p>Votre application étant buildée pour la lancer, il suffit de faire :</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8888</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php-todo:latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Votre application est maintenant <a href="http://localhost:8080" target="_blank" rel="noreferrer">disponible ici</a>.</p>`,44),t=[l];function o(c,p,u,d,h,k){return s(),i("div",null,t)}const f=e(r,[["render",o]]);export{g as __pageData,f as default};
