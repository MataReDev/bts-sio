import{_ as i,c as a,o as n,U as e,k as s}from"./chunks/framework.aGaNZw_P.js";const t="/assets/open_project.C5L_Rty2.png",l="/assets/structures.BF0QxYp8.png",r="/assets/MVVMPattern.CWET_G7F.png",p="/assets/create_package.CHCm14GN.png",o="/assets/add_manifest.C8Knqeuz.png",A=JSON.parse(`{"title":"Explication structure « Android Boilerplate »","description":"Ce document n'est pas un TP, mais une explication de la structure « Android Boilerplate »","frontmatter":{"description":"Ce document n'est pas un TP, mais une explication de la structure « Android Boilerplate »"},"headers":[],"relativePath":"tp/android/sample-explication.md","filePath":"tp/android/sample-explication.md","lastUpdated":1640899309000}`),d={name:"tp/android/sample-explication.md"},c=e('<h1 id="explication-structure-«-android-boilerplate-»" tabindex="-1">Explication structure « Android Boilerplate » <a class="header-anchor" href="#explication-structure-«-android-boilerplate-»" aria-label="Permalink to &quot;Explication structure « Android Boilerplate »&quot;">​</a></h1><p>Ce document n&#39;est pas un TP, mais une explication de la structure « Android Boilerplate » disponible à l&#39;adresse suivante :</p><ul><li><a href="https://github.com/c4software/Android-Boilerplate-Koin-CoRoutines-OkHTTP" target="_blank" rel="noreferrer">Android Boilerplate Koin - Rx - OkHttp</a></li></ul><p>Ce document vous donnera les clés afin de comprendre le fonctionnement et de vous l&#39;approprier.</p><div class="danger custom-block"><p class="custom-block-title">XML ou Compose ?</p><p>Nous sommes en 2021, le monde d&#39;Android évolue… Pendant des années l&#39;écriture des « layouts » (interface) n&#39;était possible que via du XML. Il est maintenant possible d&#39;écrire les layouts de manières bien plus modernes avec <a href="https://developer.android.com/jetpack/compose" target="_blank" rel="noreferrer">JetPack Compose</a>. Le TP que vous suivez est toujours valide, mais repose sur l&#39;utilisation de XML.</p></div><h2 id="but-du-code" tabindex="-1">But du code <a class="header-anchor" href="#but-du-code" aria-label="Permalink to &quot;But du code&quot;">​</a></h2><p>Le but du code fourni sur Github est de simplifier la mise en place d&#39;une base applicative Android « moderne ». Il ne contient aucun code (presque). Il est donc clonnable / téléchargeable et utilisable tel quel, l&#39;idée étant vraiment d&#39;avoir presque un template d&#39;application réutilisable à volonté.</p><p>Ceci étant annoncé, passons au détail du fonctionnement.</p><h2 id="recuperer-le-code" tabindex="-1">Récupérer le code <a class="header-anchor" href="#recuperer-le-code" aria-label="Permalink to &quot;Récupérer le code&quot;">​</a></h2><p>Pour récupérer le code source, vous avez deux possibilités :</p><ul><li>Le fichier zip en provenance de Github : <a href="https://github.com/c4software/Android-Boilerplate-Koin-CoRoutines-OkHTTP/archive/master.zip" target="_blank" rel="noreferrer">À télécharger ici</a></li><li>En clonant le repository : <code>git clone git@github.com:c4software/Android-Boilerplate-Koin-CoRoutines-OkHTTP.git</code></li></ul><p>⚠️ Attention, si vous avez choisi de cloner le repository. Pensez bien à supprimer le dossier <code>.git</code> à la racine des sources afin de ne pas garder l&#39;historique de mon projet. ⚠️</p><h2 id="lancer-le-projet-une-premiere-fois" tabindex="-1">Lancer le projet une première fois <a class="header-anchor" href="#lancer-le-projet-une-premiere-fois" aria-label="Permalink to &quot;Lancer le projet une première fois&quot;">​</a></h2><p>Avant d&#39;effectuer des modifications dans le projet, nous allons le lancer une première fois. Pour ça, il suffit d&#39;ouvrir le projet avec Android Studio.</p><p><img src="'+t+'" alt="Ouvrir le projet" loading="lazy"></p><p>Une fois l&#39;indexation terminée, vous devez pouvoir lancer le projet sur un émulateur ou sur votre téléphone. Ce qui devrait donner quelque chose comme :</p><p><img src="https://github.com/c4software/Android-Boilerplate-Koin-CoRoutines-OkHTTP/blob/master/capture.png?raw=true" alt="Demo" loading="lazy"></p><h2 id="la-structure-des-dossiers" tabindex="-1">La structure des dossiers <a class="header-anchor" href="#la-structure-des-dossiers" aria-label="Permalink to &quot;La structure des dossiers&quot;">​</a></h2><p>Afin de simplifier l&#39;entrée dans le code, j&#39;ai volontairement limité l&#39;organisation des dossiers au strict minimum. Attention, ça ne veut pas dire que vous ne pouvez pas en créer d&#39;autres pour organiser votre code au mieux.</p><p><img src="'+l+'" alt="structure dossier" loading="lazy"></p><ul><li><code>data</code> : Contiens la définition (interface) de vos sources de données (exemple la définition des appels réseau).</li><li><code>di</code> : La définition des éléments qui sont « injectés ».</li><li><code>domain</code> : Votre code métier, celui qui fait le traitement (soit local, ou alors les appels aux APIs HTTP par exemple)</li><li><code>utils</code> : L&#39;ensemble de vos « helpers » / fonctions que vous vous servez à plusieurs endroits dans votre code.</li><li><code>view</code> : Vos « vues », c&#39;est-à-dire vos différents écrans de votre application.</li></ul><h2 id="mvvm-kezako" tabindex="-1">MVVM ? Kézako !? <a class="header-anchor" href="#mvvm-kezako" aria-label="Permalink to &quot;MVVM ? Kézako !?&quot;">​</a></h2><p>L’acronyme MVVM signifie Modèle Vue Vue-Modèle (Model–view–viewmodel). L&#39;architecture MVVM est « plutôt récente » elle date de 2004, elle est inventée à la base par Microsoft afin de simplifier les problématiques de gestion de l&#39;interface (en utilisant des mécaniques d&#39;évènement)</p><p>Elle a récemment été popularisée par certains frameworks JavaScript, car elle permet d&#39;implémenter « simplement » des interfaces avec une réactivité importante.</p><p><img src="'+r+`" alt="MVVM Pattern" loading="lazy"></p><p>Cette méthode permet, tel le modèle MVC (modèle-vue-contrôleur), de séparer la vue de la logique et de l&#39;accès aux données en accentuant les principes de liaison et d’évènement.</p><p>Il faut donc distinguer <em>3 parties</em> :</p><ul><li>Le modèle : Les données au sens pures (de la data sous forme d&#39;objet), elles peuvent provenir d&#39;API, de base de données, de sources locales.</li><li>La vue : L&#39;affichage utilisé utilisateur, la gestion des clicks… Et <em>uniquement</em> ça, la logique associée à la donnée est effectuée dans le <code>Vue-Modèle</code> (via « le bus des évènements »)</li><li>Le Vue-Modèle : Intéragie avec la couche <code>modèle</code> et envoi les nouveaux états résultat à la vue (via le « bus des évènements »).</li></ul><p>Nous allons, donc devoir définir « des » bus de communication entre le Vue-Modèle et la Vue afin de permettre l&#39;actualisation des données. Cette organisation vous nous permettre une fois en place de ne manipuler essentiellement plus que de la donnée. La vue sera donc « automatiquement » mise à jour, et ce en fonction de l&#39;état de la donnée (exemple les loaders / les mises à jour de liste, etc.)</p><p>📖Pour ceux ayant déjà fait du VueJS (ou autre framework JavaScript récent), le découpage est très proche, vous ne serez pas perdu.</p><h2 id="di-injection-de-dependances-koin-quelques-explications" tabindex="-1">DI ? Injection de dépendances, Koin quelques explications <a class="header-anchor" href="#di-injection-de-dependances-koin-quelques-explications" aria-label="Permalink to &quot;DI ? Injection de dépendances, Koin quelques explications&quot;">​</a></h2><p>En introduction j&#39;ai indiqué que mon « Boilerplate » était le strict minimum viable pour un projet… Et bien je vous ai menti ! Mais garder confiance c&#39;est pour votre bien…</p><p>Alors, l&#39;injection des dépendances petite définition Wikipedia :</p><blockquote><p>Il consiste à créer dynamiquement (injecter) les dépendances entre les différents objets en s&#39;appuyant sur une description (fichier de configuration ou métadonnées) ou de manière programmatique. Ainsi les dépendances entre composants logiciels ne sont plus exprimées dans le code de manière statique, mais déterminées dynamiquement à l&#39;exécution.</p></blockquote><p>Pour faire simple, le but est de ne plus avoir à créer des objets dans votre code. Tout est géré « plus haut » afin de centraliser la configuration, la manière dont l&#39;objet est créé, etc.</p><p>Quelques avantages à utiliser de l&#39;injection :</p><ul><li>Réduction du code (les créations d&#39;objets sont effectuées qu&#39;une seule fois et injectées automatiquement grâce au typage).</li><li>Réduction de la mémoire, logique moins d&#39;instance d&#39;objet identique créer à plusieurs endroits dans votre code.</li><li>Isolation entre la logique de l&#39;objet et votre code, vous n&#39;êtes qu&#39;un consommateur de fonctionnalités la logique peut-être carrément écrite par quelqu&#39;un d&#39;autre, voir dans certains cas externalisés dans des librairies externes (Kotlin Native par exemple).</li><li>Etc.</li></ul><h3 id="koin" tabindex="-1">Koin <a class="header-anchor" href="#koin" aria-label="Permalink to &quot;Koin&quot;">​</a></h3><p>Dans notre nous allons utiliser la librairie Koin, elle est complètement écrite en Kotlin, elle a comme avantage d&#39;être simple à utiliser avec très peut de code à écrire (et donc à comprendre).</p><h3 id="concretement-ca-ressemble-a-quoi" tabindex="-1">Concrètement ça ressemble à quoi <a class="header-anchor" href="#concretement-ca-ressemble-a-quoi" aria-label="Permalink to &quot;Concrètement ça ressemble à quoi&quot;">​</a></h3><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> appModule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Inject dependencies for the MainViewModel (the only UI in this boilerplate)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    viewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MainViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Sample Remote Data Repository</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    single</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SampleRemoteRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(createdAtStart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SampleRemoteRemoteRepositoryImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Sample Local Data Repository</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    single</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SampleLocalRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(createdAtStart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SampleLocalRepositoryImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> remoteDataSourceModule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // provided web components</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    single</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createOkHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Fill property</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    single</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWebService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SampleRemoteDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), BuildConfig.REMOTE_URI) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> moduleApp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> listOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appModule, remoteDataSourceModule)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>L&#39;ensemble est, je pense, relativement parlant, mais regardons en détail le <code>get()</code>, comme vous pouvez le voir celui-ci est présent un peu partout dans la déclaration de nos éléments à injecter. Ce mot-clé est <em>magique</em> il permet à <a href="https://insert-koin.io/" target="_blank" rel="noreferrer">Koin</a> de détecter le type de paramètre attendu et d&#39;injecter automatiquement le bon objet.</p><p>Par exemple nous indiquons que <code>createWebService(client: OkHttpClient, url: String)</code>, automatiquement Koin va chercher dans les objets qu&#39;il connait ceux correspondant à la signature (dans notre cas <code>single { createOkHttpClient() }</code>) et <code>BuildConfig.REMOTE_URI</code> étant la String attendu.</p><p>Dans le cas d&#39;un objet de notre vue, nous avons dans le même principe :</p><p><code>viewModel { MainViewModel(get(), get()) }</code> qui représente le View-Modele de notre Activity.</p><p>Celui-ci attend deux paramètres :</p><p><code>MainViewModel(sampleRemoteRepository: SampleRemoteRepository, sampleLocalRepository: SampleLocalRepository)</code>.</p><p>Compliqué ? Pas tellement, avec la pratique ça vous semblera automatique. 😊</p><h2 id="modifier-le-package-«-sample-»" tabindex="-1">Modifier le package « sample » <a class="header-anchor" href="#modifier-le-package-«-sample-»" aria-label="Permalink to &quot;Modifier le package « sample »&quot;">​</a></h2><p>Comme vous le savez, sur Android les applications doivent être uniques « de manière cryptographique » une partie du test est basé sur leur package. Nous allons donc faire en sorte de personnaliser le package afin de le rendre unique pour vous et votre téléphone.</p>`,50),h=s("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/3tULbe0wPmU",frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,-1),u=e(`<h2 id="changer-le-nom-de-l-application" tabindex="-1">Changer le nom de l&#39;application <a class="header-anchor" href="#changer-le-nom-de-l-application" aria-label="Permalink to &quot;Changer le nom de l&#39;application&quot;">​</a></h2><p>Si vous regardez dans votre liste d&#39;application vous allez trouver une application nommée <code>Boilerplate - Koin - Retrofit</code>. Pour le changer, c&#39;est simple, il suffit d&#39;éditer le fichier <code>strings.xml</code>.</p><p>⚠️ En parlant de ce fichier, celui-ci <em>doit</em> contenir l&#39;ensemble de vos textes (et évidemment pas uniquement le nom de votre application).</p><h2 id="changer-la-configuration-de-l-api" tabindex="-1">Changer la configuration de l&#39;API <a class="header-anchor" href="#changer-la-configuration-de-l-api" aria-label="Permalink to &quot;Changer la configuration de l&#39;API&quot;">​</a></h2><p>Centraliser la configuration dans une application est <em>essentiel</em> au-delà de l&#39;organisation du code, c&#39;est essentiel pour que vous puissiez travailler en équipe, mais également pour reprendre votre code sereinement dans quelques années (eh oui…). Dans notre application la configuration sera centralisée dans le fichier <code>build.gradle</code>.</p><p>Si vous regardez le fichier en question, vous allez trouver <code>buildConfigField</code> cette instruction nous permettra de définir de la configuration propre à l&#39;environnement (Prod, Dev, Staging, etc.). Bref c&#39;est génial !</p><p>J&#39;ai donc initialisé dans mon petit Boilerplate <code>REMOTE_URI</code> qui sera dans votre code Kotlin l&#39;URL de votre serveur distant.</p><h2 id="repository-kezako" tabindex="-1">Repository ? Kézako !? <a class="header-anchor" href="#repository-kezako" aria-label="Permalink to &quot;Repository ? Kézako !?&quot;">​</a></h2><p>Contiens la logique autour de vos données. Elle expose au reste de l&#39;application une API (Interne) permettant de gérer la mise à jour des données.</p><p>Cette « brique de code » va permettre d&#39;agréger les différentes sources de données afin d&#39;être utilisable simplement dans vos VueModel (ViewModel).</p><p>🛑 N&#39;hésitez pas à découper autant qu&#39;il le faut votre logique dans différents repository 🙏</p><h3 id="localrepository" tabindex="-1">LocalRepository ? <a class="header-anchor" href="#localrepository" aria-label="Permalink to &quot;LocalRepository ?&quot;">​</a></h3><p>Dans le code fourni en exemple, le <code>Local Repository</code> « simule » un repository qui accèderait à des données « local » c&#39;est-à-dire dans votre téléphone (mémoire interne par exemple).</p><h3 id="remoterepository" tabindex="-1">RemoteRepository ? <a class="header-anchor" href="#remoterepository" aria-label="Permalink to &quot;RemoteRepository ?&quot;">​</a></h3><p>Dans le code fourni en exemple, le <code>Remote Repository</code> « simule » une interaction avec « l&#39;extérieur » de votre téléphone c&#39;est-à-dire dans notre cas <code>Internet</code> via un appel d&#39;API via le protocole HTTP.</p><h2 id="ajouter-une-nouvelle-route-d-api-distance" tabindex="-1">Ajouter une nouvelle route d&#39;API distance <a class="header-anchor" href="#ajouter-une-nouvelle-route-d-api-distance" aria-label="Permalink to &quot;Ajouter une nouvelle route d&#39;API distance&quot;">​</a></h2><p>Ajouter une nouvelle route d&#39;API à notre projet va se résumer à la modification de quelques fichiers. À premier vu ça peut sembler fastidieux, mais vous allez rapidement voir que ce découpage va nous permettre d&#39;organiser le code au mieux afin de le rendre maintenant dans la durée. Et finalement n&#39;est-ce pas le plus important ?</p><p>Je vais prendre un exemple simple, le souhaite ajouter une nouvelle route disponible sur <code>https://rest.ensembl.org/</code> dans mon projet. Au hasard la route <code>/info/rest?content-type=application/json</code>.</p><p>🤔Je rappelle au passage que la finalité est de « Récupérer l&#39;information » du serveur, le faire transiter dans votre code, pour au final l&#39;afficher quelque part dans votre application.</p><h3 id="declarer-l-appel-http-dans-sampleremotedatasource" tabindex="-1">Déclarer l&#39;appel HTTP dans SampleRemoteDataSource <a class="header-anchor" href="#declarer-l-appel-http-dans-sampleremotedatasource" aria-label="Permalink to &quot;Déclarer l&#39;appel HTTP dans SampleRemoteDataSource&quot;">​</a></h3><p>Déclarer une méthode dans le fichier <code>sampleRemoteDataSource.kt</code>, ce fichier est une Interface, qui va « déclarer » l&#39;ensemble des méthodes HTTP appelable dans le code. La déclaration de celles-ci est effectuée via des annotations (symbolisé avec <code>@</code>). Dans notre cas le fichier contient actuellement :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;info/ping?content-type=application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-type: application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PingResult</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Nous déclarons donc une méthode de type <code>GET</code> qui consommera un retour en JSON.</p><p>Nous allons ajouter la seconde méthode de la même façon</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;info/rest?content-type=application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Content-type: application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">suspend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> restInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RestResult</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Vous allez devoir créer une Data Class <code>RestResult</code> qui servira à déserialser le retour de l&#39;API. Elle va ressembler à :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RestResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> release: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>👀Attention 👀 ranger le fichier dans le bon dossier/package ! À savoir <code>data/models/RestResult</code>.</p><h4 id="comment-ca-fonctionne-en-deux-mots" tabindex="-1">Comment ça fonctionne en deux mots ? <a class="header-anchor" href="#comment-ca-fonctionne-en-deux-mots" aria-label="Permalink to &quot;Comment ça fonctionne en deux mots ?&quot;">​</a></h4><p>Déclarer une méthode dans une Interface pour permettre d&#39;appeler un WebService !? C&#39;est magique ? En réalité tout ça est possible grace à OkHTTP2, Retrofit, et l&#39;injection de dépendance. Pour les curieux, toute la logique est ici <code>src/main/java/com/boilerplate/app/di/remote_datasource_model.kt</code></p><h3 id="declarer-la-methode-dans-sampleremoterepository" tabindex="-1">Déclarer la méthode dans SampleRemoteRepository <a class="header-anchor" href="#declarer-la-methode-dans-sampleremoterepository" aria-label="Permalink to &quot;Déclarer la méthode dans SampleRemoteRepository&quot;">​</a></h3><p>La première étape était la déclaration dans l&#39;interface, c&#39;est chose faite. Maintenant nous allons déclarer notre méthode dans le <code>Repository</code>, donc dans la brique qui va appeler la source de données.</p><p>Nous allons donc tout simplement :</p><ul><li>Ajouter la déclaration de la méthode dans l&#39;interface <code>SampleRemoteRepository</code> nommée infoRest.</li><li>Implémenter la méthode <code>infoRest</code> dans <code>SampleRemoteRemoteRepositoryImpl</code> afin de pouvoir appeler l&#39;API.</li></ul><h3 id="l-appeler-depuis-le-code" tabindex="-1">L&#39;appeler depuis le code <a class="header-anchor" href="#l-appeler-depuis-le-code" aria-label="Permalink to &quot;L&#39;appeler depuis le code&quot;">​</a></h3><p>Pour tester (et uniquement pour tester), nous allons appeler la nouvelle méthode depuis la vue principale. La procédure va être relativement simple :</p><ul><li>Ajout d&#39;une méthode dans <code>MainViewModel.kt</code><ul><li>La méthode doit implémenter les states. (Chargement, et retour de la « string reçu »)</li></ul></li><li>Appeler la méthode déclarée dans le MainViewModel depuis l&#39;activity. (ex <code>myViewModel.getRestInfomations()</code>).</li></ul><p>Dans l&#39;implémentation actuelle, je vous propose d&#39;afficher un <code>un Toast</code> lors de la réception de la donnée.</p><h2 id="ajouter-une-nouvelle-activity" tabindex="-1">Ajouter une nouvelle Activity <a class="header-anchor" href="#ajouter-une-nouvelle-activity" aria-label="Permalink to &quot;Ajouter une nouvelle Activity&quot;">​</a></h2><p>Maintenant que nous avons validé que notre code fonctionne, nous allons pouvoir ajouter une nouvelle vue. Nous avons une nouvelle route <code>infoRest</code> qui pour l&#39;instant est inutilisée, nous allons créer une vue et le code associé afin d&#39;afficher l&#39;information reçue du serveur.</p><h3 id="layout" tabindex="-1">Layout <a class="header-anchor" href="#layout" aria-label="Permalink to &quot;Layout&quot;">​</a></h3><p>La première étape va être la création de la vue. Pour ça créer un Layout XML comme nous avons déjà pu le voir ensemble.</p><h3 id="code" tabindex="-1">Code <a class="header-anchor" href="#code" aria-label="Permalink to &quot;Code&quot;">​</a></h3><p>Le minimum de code pour que votre activity fonctionne est le suivant :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> YourActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppCompatActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    companion</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getStartIntent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Intent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Intent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, YourActivity::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.java)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(savedInstanceState: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Bundle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(savedInstanceState)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setContentView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(R.layout.activity_demo)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>👀 Comme toujours l&#39;organisation du code est une chose très importante, ne placez pas votre classe n&#39;importe où. Mais dans un package dans <code>view</code> :</p><p><img src="`+p+'" alt="create package" loading="lazy"></p>',47),k=s("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/M1RJ1kQg7Hg",frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,-1),m=e(`<p>Si vous souhaitez plus de détail, inspirer du code présent dans le <code>MainActivity.kt</code> ou dans les exemples que nous avons évoqués pendant le cours.</p><h4 id="getstartintent" tabindex="-1">getStartIntent ? <a class="header-anchor" href="#getstartintent" aria-label="Permalink to &quot;getStartIntent ?&quot;">​</a></h4><p>Cette méthode a pour but de simplifier la lecture (et la navigation) entre les vues. Cette méthode est statique, elle sera appelée que vous souhaiterez appeler votre <code>activity</code> depuis une autre <code>vue</code> / <code>activity</code>. Elle retourne une <code>Intent</code> qui nous servira à démarrer l&#39;activity souhaitée.</p><p><em>Exemple :</em></p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    startActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MainActivity.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStartIntent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Le but également de créer des <code>getStartIntent</code> est de simplifier la gestion du passage des paramètres. En effet, sur Android passer des paramètres à une activité se résume à les attacher à l&#39;Intent. Centraliser la déclaration, permet également de centraliser cette logique.</p><p><em>Exemple :</em></p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">companion</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AGE_DU_CAPITPAINE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;AGE_DU_CAPITPAINE&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getStartIntent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ageDuCapitaine: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Intent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Intent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, MainActivity::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.java).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            putExtra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(FROM_HOME, ageDuCapitaine)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pour récupérer cette valeur.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ageDuCapitaine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> intent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBooleanExtra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AGE_DU_CAPITPAINE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">33</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="rendre-accessible-cette-vue-activity" tabindex="-1">Rendre accessible cette vue / activity <a class="header-anchor" href="#rendre-accessible-cette-vue-activity" aria-label="Permalink to &quot;Rendre accessible cette vue / activity&quot;">​</a></h2><p>Maintenant que cette activity est créée, nous allons devoir la rendre « visible » par Android. Cette étape est relativement simple. Il suffit de laisser faire votre IDE pour lui faire autodéclarer le bon XML dans le fichier <code>AndroidManifest.xml</code>.</p><p>Si vous souhaitez réaliser cette action à la main. Il suffit d&#39;ajouter « dans / sous » l&#39;élément application :</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">activity</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.boilerplate.app.view.main.MainActivity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>⚠️ Mais sérieusement, ne l&#39;ajoutez pas à la main. Faite plutôt alt entrée sur le nom de votre class dans l&#39;IDE l&#39;action vous sera proposée.</p><p><img src="`+o+`" alt="ajouter au manifeste" loading="lazy"></p><h3 id="creer-une-home" tabindex="-1">Créer une home <a class="header-anchor" href="#creer-une-home" aria-label="Permalink to &quot;Créer une home&quot;">​</a></h3><p>En suivant le même principe que précédemment, créez une Home avec deux boutons permettant d&#39;accéder à la <code>MainActivity</code> et à <code>InfoRestActivity</code>.</p><p>Petit rappel, pour « attacher » une action de clique sur un bouton :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">btnMain.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setOnClickListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    startActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MainActivity.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStartIntent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">btnInfosRest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setOnClickListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    startActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(InfoRestActivity.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStartIntent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="declarer-cette-home-comme-activity-principale-de-votre-application" tabindex="-1">Déclarer cette home comme activity principale de votre application <a class="header-anchor" href="#declarer-cette-home-comme-activity-principale-de-votre-application" aria-label="Permalink to &quot;Déclarer cette home comme activity principale de votre application&quot;">​</a></h3><p>Un certain nombre de paramètres autour des intent est modifiable directement dans <code>AndroidManifest.xml</code>, la déclaration de <code>l&#39;intent</code> à lancer au démarrage de l&#39;application est faite via :</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">intent-filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">action</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.intent.action.MAIN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">category</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.intent.category.LAUNCHER&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">intent-filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Déplacer <code>l&#39;intent filter</code> dans bloc correspondant à votre activity.</p><h3 id="connecter-le-tout" tabindex="-1">Connecter le tout <a class="header-anchor" href="#connecter-le-tout" aria-label="Permalink to &quot;Connecter le tout&quot;">​</a></h3><p>Votre application contient maintenant 3 activités :</p><ul><li>Une home.</li><li>L&#39;activité permettant de connaitre la version du serveur. <code>infoRest</code></li><li>Une activité permettant de « réaliser des pings ».</li></ul><p>Appeler les différends <code>getStartIntent()</code> depuis les bonnes vues.</p><p>Exemple :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> startMainActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    startActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MainActivity.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStartIntent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="utiliser-un-repository-depuis-une-nouvelle-activity" tabindex="-1">Utiliser un Repository depuis une nouvelle activity <a class="header-anchor" href="#utiliser-un-repository-depuis-une-nouvelle-activity" aria-label="Permalink to &quot;Utiliser un Repository depuis une nouvelle activity&quot;">​</a></h2><p>Comme indiqué précédemment, nous n&#39;allons pas directement appeler notre <code>Repository</code> directement depuis notre <code>Activity</code>.</p><div class="tip custom-block"><p class="custom-block-title">Petit rappel</p><p>Nous allons découper notre logique en différentes parties :</p><ul><li>La logique de la vue va rester dans l&#39;Activity.</li><li>La logique des données de la vue va être mise dans la partie <code>ViewModel</code>.</li><li>La logique « de récupération » des données va être mise dans un <code>Repository</code>.</li></ul></div><p>Créer un ViewModel pour une <code>Activity</code> va se résumer à trois opérations :</p><ul><li>Créer une Class <code>YourActivityViewModel</code> et qui extend de <code>BaseViewModel()</code></li><li>Déclarer votre <code>YourActivityViewModel</code> dans l&#39;activity en spécifiant que celui-ci sera automatiquement injecté.</li><li>Le déclarer dans l&#39;injecteur de dépendances.</li></ul><h3 id="creation-de-votre-youractivityviewmodel" tabindex="-1">Création de votre <code>YourActivityViewModel</code> <a class="header-anchor" href="#creation-de-votre-youractivityviewmodel" aria-label="Permalink to &quot;Création de votre \`YourActivityViewModel\`&quot;">​</a></h3><p>Cette étape est la première, nous allons créer une Class qui contiendra la « logique » des données de la vue, le minimum que doit contenir cette classe est :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> YourActivityViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> states </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MutableLiveData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ViewModelState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Vous déclarerez ici vos méthodes et variables nécessaires</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // au bon fonctionnement de votre application.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Vous voulez un exemple « plus grand » ?</p><p>Vous avez dans le projet un exemple de <code>ViewModel</code> un peu plus complet, c&#39;est le fichier <code>MainViewModel.kt</code> il est également <a href="https://raw.githubusercontent.com/c4software/Android-Boilerplate-Koin-CoRoutines-OkHTTP/master/app/src/main/java/com/boilerplate/app/view/main/MainViewModel.kt" target="_blank" rel="noreferrer">accessible ici</a></p></div><h3 id="declarer-votre-viewmodel-dans-l-activity" tabindex="-1">Déclarer votre ViewModel dans l&#39;activity <a class="header-anchor" href="#declarer-votre-viewmodel-dans-l-activity" aria-label="Permalink to &quot;Déclarer votre ViewModel dans l&#39;activity&quot;">​</a></h3><p>Pour ça rien de bien compliqué, il suffit d&#39;ajouter le code suivant :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myViewModel: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">YourActivityViewModel</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> by</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> viewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="danger custom-block"><p class="custom-block-title">Attention</p><p>Ne pas mettre le code n&#39;importe où. Nous avons ici un <strong>attribut de class</strong>.</p></div><h3 id="declaration-dans-l-injecteur-de-dependance" tabindex="-1">Déclaration dans l&#39;injecteur de dépendance <a class="header-anchor" href="#declaration-dans-l-injecteur-de-dependance" aria-label="Permalink to &quot;Déclaration dans l&#39;injecteur de dépendance&quot;">​</a></h3><p>Si vous souhaitez que ça fonctionne, vous devez dire à votre code comment le <code>by viewModel()</code> va être résolu. Pour ça nous devons indiquer à notre injecteur de dépendance comment créer cette dépendance, cette déclaration est à faire dans le fichier <code>app_module.kt</code> (il se trouve dans le package <code>.di</code>).</p><p>Vous devez donc ajouter dans le <code>appModule</code> le code suivant :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    viewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">YourActivityViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>🤓 Bien évidemment, vous ajoutez le code à la suite du <code>viewModel</code> déjà présent 🤓</p>`,46),g=[c,h,u,k,m];function E(v,y,b,f,F,C){return n(),a("div",null,g)}const B=i(d,[["render",E]]);export{A as __pageData,B as default};
