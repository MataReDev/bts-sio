import{_ as a,c as e,I as i,w as n,U as l,D as t,o as p,k as r}from"./chunks/framework.aGaNZw_P.js";const y=JSON.parse(`{"title":"Déployer Mini-MVC-Sample sur Apache","description":"Un petit TP/Guide rapide pour créer installer et configurer un serveur Apache afin d'y déployer Mini MVC Sample.","frontmatter":{"description":"Un petit TP/Guide rapide pour créer installer et configurer un serveur Apache afin d'y déployer Mini MVC Sample."},"headers":[],"relativePath":"tp/ops/mini-mvc-sample/deployer-mini-mvc-sample.md","filePath":"tp/ops/mini-mvc-sample/deployer-mini-mvc-sample.md","lastUpdated":1704112852000}`),h={name:"tp/ops/mini-mvc-sample/deployer-mini-mvc-sample.md"},o=l(`<h1 id="deployer-mini-mvc-sample-sur-apache" tabindex="-1">Déployer Mini-MVC-Sample sur Apache <a class="header-anchor" href="#deployer-mini-mvc-sample-sur-apache" aria-label="Permalink to &quot;Déployer Mini-MVC-Sample sur Apache&quot;">​</a></h1><p>Un petit TP/Guide rapide pour créer, installer et configurer un serveur Apache afin d&#39;y déployer Mini MVC Sample. Déployer un site Mini MVC Sample est assez similaire à ce que vous connaissez déjà, cependant il y aura quelques exceptions.</p><div class="tip custom-block"><p class="custom-block-title">TP prévu pour Debian</p><p>Le TP est axé sur Debian, mais il devrait fonctionner avec la plupart des distributions.</p></div><details class="details custom-block"><summary>Sommaire</summary><nav class="table-of-contents"><ul><li><a href="#apache">Apache</a></li><li><a href="#php-8">PHP 8</a></li><li><a href="#installer-votre-site">Installer votre site</a></li><li><a href="#configurer-apache">Configurer Apache</a><ul><li><a href="#_1-changer-modifier-le-documentroot-par">1 - Changer / Modifier le DocumentRoot par :</a></li><li><a href="#_2-ajouter-dans-la-configuration-du-virtualhost">2 - Ajouter dans la configuration du VirtualHost :</a></li><li><a href="#_3-redemarrer-votre-serveur-apache">3 - Redémarrer votre serveur Apache</a></li><li><a href="#_4-profit">4 - Profit !</a></li></ul></li></ul></nav></details><h2 id="apache" tabindex="-1">Apache <a class="header-anchor" href="#apache" aria-label="Permalink to &quot;Apache&quot;">​</a></h2><p>Première étape (si vous ne l&#39;avez pas déjà) est d&#39;installer Apache :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="php-8" tabindex="-1">PHP 8 <a class="header-anchor" href="#php-8" aria-label="Permalink to &quot;PHP 8&quot;">​</a></h2><p>Vous devez avoir une version récente de PHP, de base Debian arrive avec une version relativement ancienne de PHP à savoir PHP 7.3 (et des bananes). Pour ça nous allons avoir besoin d&#39;un dépôt externe, celui-ci contiendra la dernière version de PHP.</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Installation des dépendances nécessaires à l&#39;ajout d&#39;un dépôt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsb-release</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-transport-https</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gnupg2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca-certificates</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ajout du dépôt Sury</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apt/trusted.gpg.d/php.gpg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://packages.sury.org/php/apt.gpg</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;echo &quot;deb https://packages.sury.org/php/ $(lsb_release -sc) main&quot; &gt; /etc/apt/sources.list.d/php.list&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ajout de PHP et des dépendances nécessaire au bon fonctionnement de Mini MVC Sample</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php8.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php8.2-fpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php8.2-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php8.2-{bz2,curl,mbstring,intl,pdo,mysql,gd,zip}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unzip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Activer PHP dans Apache</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy_fcgi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setenvif</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> headers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">a2enconf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> php8.2-fpm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Active  Apache</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Active la réécriture d&#39;URL nécessaire pour Mini MVC Sample</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/sbin/a2enmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewrite</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">PHP-FPM ?</p><p>PHP-FPM est la nouvelle façon de faire fonctionner PHP sur un serveur. Il a plusieurs avantages :</p><ul><li>Performances accrues.</li><li>Moins de ressources utilisées.</li><li>Permet de faire tourner plusieurs versions de PHP en même temps.</li><li>Rechargement de la configuration sans redémarrage du serveur.</li></ul></div><p>Et voilà, nous avons la base, votre serveur est prêt à recevoir votre code ! Avant de continuer, vérifiez avec la commande suivante que votre version de PHP est au moins égale à <code>8</code>.</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Exemple dans mon cas :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PHP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cli) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">built:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 29</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2022</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:17:15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Copyright</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (c) The PHP Group</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Zend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Engine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v4.1.11,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Copyright</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (c) Zend Technologies</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    with</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Zend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OPcache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v8.1.11,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Copyright</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (c), by Zend Technologies</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Un instant !</p><ul><li>D&#39;où viennent ces commandes ?</li><li>Devez-vous ? Pouvez-vous me faire confiance et les copier-coller directement ?</li></ul></div><h2 id="installer-votre-site" tabindex="-1">Installer votre site <a class="header-anchor" href="#installer-votre-site" aria-label="Permalink to &quot;Installer votre site&quot;">​</a></h2><p>Pour installer votre site, nous avons deux solutions :</p><ul><li>Utiliser un FTP (ou un sftp) et déposer votre code source dans <code>/var/www/html/votresite/</code>.</li><li>Cloner le code source avec Git dans le dossier <code>/var/www/html/votresite/</code></li></ul><p>Cloner ou FTP ? Vous avez le choix !?</p><div class="tip custom-block"><p class="custom-block-title">Un instant !</p><ul><li>Avez-vous déjà cherché la différence entre FTP ou SFTP ?</li><li>Je pense qu&#39;il serait plus intéressant de passer par GIT, pourquoi selon vous ?</li></ul></div><h2 id="configurer-apache" tabindex="-1">Configurer Apache <a class="header-anchor" href="#configurer-apache" aria-label="Permalink to &quot;Configurer Apache&quot;">​</a></h2><p>La dernière étape est la configuration du serveur Apache, habituellement déposer les sources suffit à faire fonctionner un site Internet avec Mini MVC Sample nous allons avoir une étape supplémentaire :</p><p>Pour ça :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apache2/sites-available/000-default.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Dans le fichier en question vous devez :</p><h3 id="_1-changer-modifier-le-documentroot-par" tabindex="-1">1 - <strong>Changer</strong> / <strong>Modifier</strong> le <code>DocumentRoot</code> par : <a class="header-anchor" href="#_1-changer-modifier-le-documentroot-par" aria-label="Permalink to &quot;1 - **Changer** / **Modifier** le \`DocumentRoot\` par :&quot;">​</a></h3><div class="language-txt vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>DocumentRoot /var/www/html/votresite</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-ajouter-dans-la-configuration-du-virtualhost" tabindex="-1">2 - Ajouter <strong>dans</strong> la configuration du <code>VirtualHost</code> : <a class="header-anchor" href="#_2-ajouter-dans-la-configuration-du-virtualhost" aria-label="Permalink to &quot;2 - Ajouter **dans** la configuration du \`VirtualHost\` :&quot;">​</a></h3><div class="language-txt vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># Autorise l&#39;exécution des fichiers .htaccess dans votre site.</span></span>
<span class="line"><span>&lt;Directory /var/www/html/votresite&gt;</span></span>
<span class="line"><span>    AllowOverride All</span></span>
<span class="line"><span>&lt;/Directory&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Cette partie est importante, elle permet d&#39;activer la réécriture d&#39;URL nécessaire pour Mini MVC Sample.</strong>, il faut l&#39;ajouter dans la configuration du <code>VirtualHost</code> (entre les balises <code>&lt;VirtualHost&gt;</code> et <code>&lt;/VirtualHost&gt;</code>).</p><details class="details custom-block"><summary>Un exemple du résultat</summary><p>Dans mon cas voilà le résultat :</p><div class="language-txt vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>&lt;VirtualHost *:80&gt;</span></span>
<span class="line"><span>    ServerAdmin admin@example.com</span></span>
<span class="line"><span>    DocumentRoot /var/www/html/votresite</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &lt;Directory /var/www/html/votresite&gt;</span></span>
<span class="line"><span>        AllowOverride all</span></span>
<span class="line"><span>    &lt;/Directory&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ErrorLog \${APACHE_LOG_DIR}/error.log</span></span>
<span class="line"><span>    CustomLog \${APACHE_LOG_DIR}/access.log combined</span></span>
<span class="line"><span>&lt;/VirtualHost&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></details><div class="tip custom-block"><p class="custom-block-title">Un Instant !</p><p>Comprendre la configuration c&#39;est important, c&#39;est une partie importante de votre métier (et ça fait partie de la sécurité).</p><ul><li>Comment comprendre ce que vous avez configuré ? <a href="https://httpd.apache.org/docs/2.4/configuring.html" target="_blank" rel="noreferrer">Vous avez de la chance la documentation est en Français.</a></li><li>Pourquoi vous devez faire attention à ce que vous copiez/collez ?</li></ul></div><h3 id="_3-redemarrer-votre-serveur-apache" tabindex="-1">3 - Redémarrer votre serveur Apache <a class="header-anchor" href="#_3-redemarrer-votre-serveur-apache" aria-label="Permalink to &quot;3 - Redémarrer votre serveur Apache&quot;">​</a></h3><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_4-profit" tabindex="-1">4 - Profit ! <a class="header-anchor" href="#_4-profit" aria-label="Permalink to &quot;4 - Profit !&quot;">​</a></h3><p>Voilà ! Votre site est maintenant fonctionnel sur votre serveur.</p><p>Félicitation !</p>`,38),c=r("iframe",{src:"https://giphy.com/embed/NEvPzZ8bd1V4Y",width:"459",height:"480",frameBorder:"0",class:"giphy-embed",allowFullScreen:""},null,-1);function d(u,k,m,g,b,F){const s=t("center");return p(),e("div",null,[o,i(s,null,{default:n(()=>[c]),_:1})])}const C=a(h,[["render",d]]);export{y as __pageData,C as default};
