import{_ as t,c as n,I as l,w as r,U as s,k as e,a as i,D as o,o as p}from"./chunks/framework.aGaNZw_P.js";const d="/assets/alpine_choice.dhQ8Zmjo.png",u="/assets/alpine_boot.BPdRxW1J.png",c="/assets/qwerty.D7ZjzMc1.png",h="/assets/repo_community.DlE_9Cta.png",m="/assets/alpine_docker.BzgrflUE.png",P=JSON.parse(`{"title":"Alpine Linux, K3d & Docker","description":"Un petit TP/Guide rapide pour créer une VM légère et rapide afin d'héberger un cluster Kubernetes.","frontmatter":{"description":"Un petit TP/Guide rapide pour créer une VM légère et rapide afin d'héberger un cluster Kubernetes."},"headers":[],"relativePath":"tp/devops/alpine-vm.md","filePath":"tp/devops/alpine-vm.md","lastUpdated":1706995581000}`),k={name:"tp/devops/alpine-vm.md"},b=s('<h1 id="alpine-linux-k3d-docker" tabindex="-1">Alpine Linux, K3d &amp; Docker <a class="header-anchor" href="#alpine-linux-k3d-docker" aria-label="Permalink to &quot;Alpine Linux, K3d &amp; Docker&quot;">​</a></h1><p>Un petit TP/Guide rapide pour créer une VM légère et rapide afin d&#39;héberger un cluster Kubernetes (ou un simple serveur permettant de lancer des machines via Docker)</p><details class="details custom-block"><summary>Sommaire</summary><nav class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#l-iso">L&#39;ISO</a></li><li><a href="#l-installation">L&#39;installation</a><ul><li><a href="#premier-boot">Premier boot</a></li><li><a href="#premier-reboot">Premier reboot</a></li><li><a href="#premiere-etape-les-depots">Première étape : Les dépôts</a></li><li><a href="#installer-les-paquets">Installer les paquets</a></li></ul></li><li><a href="#docker">Docker</a></li><li><a href="#k3d">K3D</a></li></ul></nav></details><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>Créer rapidement une VM peut-être intéressant pour par exemple créer rapidement un petit cluster Kubernetes (dans le but de tester la simulation d&#39;un serveur / ordinateur distant). L&#39;idée de ce TP est donc de vous montrer comment vous pouvez grâce à Alpine Linux créer très très rapidement une VM à partir d&#39;un fichier ISO de seulement… 133Mo ! Ici pas d&#39;interface graphique ni de ressources inutiles nous allons créer une « micro vm » avec seulement les éléments nécessaires au bon fonctionnement de notre cluster à savoir « Docker &amp; K3D ».</p><p>Alpine Linux est une distribution bien connue des gens créant des conteneurs avec Docker, en effet sa légèreté et sa très petite taille ont font souvent un choix idéal pour ne pas produire des containers inutilement trop gros / avec trop des binaires inutile.</p><p><a href="https://alpinelinux.org/" target="_blank" rel="noreferrer">Pour en savoir plus sur Alpine Linux, rendez-vous sur le site officiel</a></p><h2 id="l-iso" tabindex="-1">L&#39;ISO <a class="header-anchor" href="#l-iso" aria-label="Permalink to &quot;L&#39;ISO&quot;">​</a></h2><p>Pour l&#39;ISO le plus simple est de se rendre sur le site officiel dans la <a href="https://alpinelinux.org/downloads/" target="_blank" rel="noreferrer">partie Download</a></p><p><img src="'+d+'" alt="Choix" loading="lazy"></p><p>Dans mon cas (et certainement dans le vôtre aussi), je choisis X86_64 ce qui signifie que je vais installer ma machine virtuelle pour :</p><ul><li>Un ordinateur avec un processeur X86 (Intel ou AMD) de type 64bits.</li></ul><h2 id="l-installation" tabindex="-1">L&#39;installation <a class="header-anchor" href="#l-installation" aria-label="Permalink to &quot;L&#39;installation&quot;">​</a></h2><p>L&#39;installation d&#39;une Alpine Linux est légèrement différente d&#39;une installation type Debian / Ubuntu ou autre distribution classique. L&#39;ensemble de l&#39;installation est faite en ligne de commande (un peu comme Archlinux ou Gentoo). Écrit comme ça, vous avez peut-être peur ? Mais ne vous inquiétez pas ça va être simple, j&#39;ai même tendance à penser que ça sera plus simple, et plus rapide (Dans mon cas 7min, téléchargement inclus !) !</p><p>Accrochez-vous… On démarre !</p>',15),g=e("iframe",{src:"https://giphy.com/embed/YHvwPgwojjsFa",width:"480",height:"313",frameBorder:"0",class:"giphy-embed",allowFullScreen:""},null,-1),v=s('<h3 id="premier-boot" tabindex="-1">Premier boot <a class="header-anchor" href="#premier-boot" aria-label="Permalink to &quot;Premier boot&quot;">​</a></h3><p>Je passe l&#39;étape de la création de la VM que vous connaissez déjà. Je vais m&#39;attarder sur le premier boot car celui-ci est peut-être légèrement différent de ce dont vous avez l&#39;habitude.</p><p>Le premier boot de Alpine Linux est très rapide, cette rapidité vient du fait que Alpine Linux est par défaut complètement en mode texte. Ce mode texte vous imposera de saisir quelques commandes pour procéder à son installation ; vous allez voir Alpine Linux est simple, même en ligne de commande.</p><p>Au premier boot vous tomberez sur l&#39;écran suivant :</p><p><img src="'+u+'" alt="Premier Boot" loading="lazy"></p><ul><li>Le login est : root (sans mot de passe).</li></ul><div class="warning custom-block"><p class="custom-block-title">Attention clavier qwerty</p><p>Alpine Linux est une distribution à destination du monde entier, le clavier est donc par défaut en qwerty. Celui-ci sera changé lors de l&#39;installation. Mais pour « la première commande et le login », nous allons devoir saisir le texte avec une disposition qwerty.</p><p>Si vous n&#39;avez pas le clavier en tête le voilà :</p><p><img src="'+c+'" alt="Clavier Qwerty" loading="lazy"></p></div><p>La première commande à saisir est :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setup-alpine</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>✋ Attention clavier qwerty</p><p>À partir de maintenant nous sommes en mode interactif, comme l&#39;installeur d&#39;une Debian mais simplement en mode texte seulement ; c&#39;est-à-dire qu&#39;il va vous poser des questions. Voilà mes réponses (vous pouvez utiliser les mêmes).</p><ul><li>Layout : fr</li><li>Variant : fr</li><li>hostname : localhost</li><li>Interface to initialize : eth0</li><li>Ip address for eth0 : dhcp</li><li>Manual configuration for network : n</li><li>Root password : <code>votre-mdp</code></li><li>Confirm root password : <code>votre-mdp</code></li><li>Proxy : none</li><li>Timezone : UTC</li><li>Ntp client : chrony</li><li>Enter mirror number : 1</li><li>SSH Server : openssh</li><li>Disk to use : sda</li><li>How would you like to use it : sys</li><li>Erase the disks and continue : y</li></ul><p>L&#39;installation va procéder, puis vous rendre la main. Vous pouvez retirer l&#39;ISO et saisir :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>',14),F=e("div",{class:"tip custom-block"},[e("p",{class:"custom-block-title"},"Allez plus vite…"),e("p",null,[i("Vous avez dû remarquer les valeurs entre crochets à la fin des questions. Il s’agit des valeurs « par défaut » (autrement dit celle recommandée), quand c'est comme ça il vous suffit de faire "),e("strong",null,"entrer"),i(". Ce qui donne dans mon cas en vidéo :")]),e("iframe",{width:"560",height:"315",src:"https://www.youtube-nocookie.com/embed/1y2ztFyVGuo",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""})],-1),y=s('<div class="danger custom-block"><p class="custom-block-title">Vous souhaitez une IP Fixe ?</p><p>C&#39;est complètement possible ! Lors des questions « IP address for eth0 » et « Manual configuration for network » entrez ce dont vous avez l&#39;habitude avec une Debian.</p></div><h3 id="premier-reboot" tabindex="-1">Premier reboot <a class="header-anchor" href="#premier-reboot" aria-label="Permalink to &quot;Premier reboot&quot;">​</a></h3><p>Nous allons configurer notre système afin de lui installer les paquets nécessaires à notre usage, à savoir :</p><ul><li>Docker</li><li>K3D</li></ul><p>À partir de maintenant vous pouvez utiliser le SSH.</p><h3 id="premiere-etape-les-depots" tabindex="-1">Première étape : Les dépôts <a class="header-anchor" href="#premiere-etape-les-depots" aria-label="Permalink to &quot;Première étape : Les dépôts&quot;">​</a></h3><p>Pour activer le dépôt community il suffit de décommenter une ligne dans le fichier de configuration des APK.</p><div class="tip custom-block"><p class="custom-block-title">Deux dépôts</p><p>Les dépôts de Alpine Linux sont découpés en deux :</p><ul><li>Le main (ceux actifs de base).</li><li>Le community (à activer dans un fichier).</li></ul></div><p>La première étape est d&#39;installer l&#39;éditeur de votre choix (<strong>vim</strong>, nano, etc) :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Puis il vous suffit de décommenter la <strong>3ème ligne</strong> du fichier <code>/etc/apk/repositories</code>. Vous pouvez le faire via :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apk/repositories</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Ce qui donne chez moi :</p><p><img src="'+h+`" alt="Repo Community" loading="lazy"></p><h3 id="installer-les-paquets" tabindex="-1">Installer les paquets <a class="header-anchor" href="#installer-les-paquets" aria-label="Permalink to &quot;Installer les paquets&quot;">​</a></h3><p>Pour installer les paquets, nous allons utiliser le gestionnaire de paquets de Alpine Linux à savoir <code>apk</code>. Les commandes de celui-ci ressemblent beaucoup à celle de <code>apt</code> de Debian.</p><p>Quelques commandes à savoir en vrac :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # met à jour la liste des paquets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # met à jour les paquets sur votre machine</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> du</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> paque</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # installe le paquet souhaité (si présent)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Exemple, pour installer <code>vim</code> :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">​</a></h2><p>Installer Docker sur Alpine Linux est rapide, il suffit de lancer la commande :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-cli-compose</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Install Docker et Docker Compose</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rc-update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> boot</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Active Docker au démarrage de la machine</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Démarre Docker dès maintenant</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="`+m+`" alt="Alpine Docker" loading="lazy"></p><div class="tip custom-block"><p class="custom-block-title">Vous pouvez vérifier …</p><p>Pour vérifier le bon fonctionnement, il suffit de saisir dans le terminal :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><h2 id="k3d" tabindex="-1">K3D <a class="header-anchor" href="#k3d" aria-label="Permalink to &quot;K3D&quot;">​</a></h2><p>Maintenant que nous avons installé Docker, il faut ajouter K3D. Malheureusement pour l&#39;instant celui-ci n&#39;est pas disponible dans le repo. Pour l&#39;installer il faut passer via la commande décrite dans <a href="https://github.com/rancher/k3d#get" target="_blank" rel="noreferrer">la documentation officielle.</a></p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/rancher/k3d/main/install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sh</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Installation de la commande k3D</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net/netfilter/nf_conntrack_max=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">131072</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Permet la création des agents (Un correctif est en cours de publication, bientôt plus nécéssaire)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Vous pouvez vérifier que celui-ci est bien installé via :</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k3d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --help</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">À propos du sysctl</p><p>C&#39;est un contournement temporaire, le problème est récent et sera corrigé dans une prochaine version.</p><p><a href="https://github.com/rancher/k3d/issues/607" target="_blank" rel="noreferrer">https://github.com/rancher/k3d/issues/607</a></p></div><p>Vous souhaitez découvrir le fonctionnement de K3D ? Vous pouvez suivre le <a href="/tp/ci/kubernetes/deploy-container-in-kubernetes.html">TP sur K3D</a>.</p>`,32);function f(C,_,D,q,A,B){const a=o("center");return p(),n("div",null,[b,l(a,null,{default:r(()=>[g]),_:1}),v,F,y])}const w=t(k,[["render",f]]);export{P as __pageData,w as default};
